@{
    ViewData["Title"] = "School Database Example";
}

<body data-topic="database">
<div class="container">
    <h1 class="text-center">School Database Example</h1>
    
    <div class="intro-section">
        <p>This example shows how a <strong>real school system</strong> uses a relational database to manage students, courses, and enrollments. We'll build this step-by-step with both SQL and C# code so you can see exactly how everything works.</p>
        
        <div class="real-world-context">
            <p><strong>Real-World Context:</strong> A school needs to track hundreds of students, dozens of courses, and thousands of enrollments. Without a database, this would be chaos with spreadsheets and paper records!</p>
        </div>
    </div>

    <h2 class="text-center">Complete School Database Schema</h2>
    
    <div class="database-overview">
        <div class="schema-diagram">
            <div class="code-container">
                <div class="code-header">Complete Database Structure</div>
                <div class="code-content">
<pre>
<span style="color: #198754;">-- Four connected tables for a complete school system</span>

1. STUDENTS table
   ┌──────────┬───────────┬──────────┬─────┐
   │ StudentID│ FirstName │ LastName │ Age │
   └──────────┴───────────┴──────────┴─────┘
         │
         │  3. ENROLLMENT table (Join Table)
         │     ┌─────────────┬──────────┬──────────┐
         └─────┤ StudentID   │ CourseID │  Grade   │
               └─────────────┴──────────┴──────────┘
                       │            │
                       │            │
2. COURSES table       │            │
   ┌──────────┬─────────────┐       │
   │ CourseID │ CourseName  │       │
   └──────────┴─────────────┘       │
               │                    │
               │  4. TEACHERS table │
               │     ┌──────────┬────────────┐
               └─────┤ TeacherID│  Name      │
                     └──────────┴────────────┘
</pre>
                </div>
            </div>
        </div>
        
        <div class="schema-explanation">
            <div class="explanation-point">
                <h4>Why This Design Works</h4>
                <ul>
                    <li>Each table has one clear purpose</li>
                    <li>Relationships are clear through foreign keys</li>
                    <li>No data duplication (student info stored once)</li>
                    <li>Easy to expand (add new tables as needed)</li>
                </ul>
            </div>
        </div>
    </div>

    <h2 class="text-center">1. Students Table</h2>
    
    <div class="table-section">
        <div class="table-visual">
            <div class="code-container">
                <div class="code-header">Students Table - Stores Student Information</div>
                <div class="code-content">
<pre>
┌─────────────┬─────────────┬─────────────┬─────┬──────────────┐
│ StudentID   │ FirstName   │ LastName    │ Age │   Email      │
├─────────────┼─────────────┼─────────────┼─────┼──────────────┤
│     101     │    Alice    │   Smith     │  20 │ alice@school │
│     102     │     Bob     │  Johnson    │  21 │  bob@school  │
│     103     │   Charlie   │  Williams   │  19 │ charlie@school│
│     104     │    Diana    │   Brown     │  22 │ diana@school │
└─────────────┴─────────────┴─────────────┴─────┴──────────────┘

<span style="color: #198754;">Each row = One student's complete information</span>
<span style="color: #198754;">Each column = Type of information about students</span>
</pre>
                </div>
            </div>
        </div>
        
        <div class="table-details">
            <div class="sql-code">
                <div class="code-container">
                    <div class="code-header">SQL to Create Students Table</div>
                    <div class="code-content">
<pre>
CREATE TABLE Students (
    StudentID INT PRIMARY KEY,           <span style="color: #198754;">← Unique ID for each student</span>
    FirstName VARCHAR(50) NOT NULL,      <span style="color: #198754;">← Must have first name</span>
    LastName VARCHAR(50) NOT NULL,       <span style="color: #198754;">← Must have last name</span>
    Age INT CHECK (Age >= 0 AND Age <= 120), <span style="color: #198754;">← Age validation</span>
    Email VARCHAR(100) UNIQUE,           <span style="color: #198754;">← Email must be unique</span>
    EnrollmentDate DATE DEFAULT GETDATE() <span style="color: #198754;">← Auto-fills today's date</span>
);
</pre>
                    </div>
                </div>
            </div>
            
            <div class="csharp-code">
                <div class="code-container">
                    <div class="code-header">C# Class for Students</div>
                    <div class="code-content">
<pre>
<span style="color: #198754;">// This C# class represents the Students table</span>
public class Student
{
    <span style="color: #198754;">// Properties match table columns</span>
    public int StudentID { get; set; }      <span style="color: #198754;">← Primary Key</span>
    public string FirstName { get; set; }
    public string LastName { get; set; }
    public int Age { get; set; }
    public string Email { get; set; }
    public DateTime EnrollmentDate { get; set; }
    
    <span style="color: #198754;">// Navigation property (for relationships)</span>
    public ICollection&lt;Enrollment&gt; Enrollments { get; set; }
}

<span style="color: #198754;">// Using the Student class in C#</span>
var newStudent = new Student 
{
    StudentID = 105,
    FirstName = "Emma",
    LastName = "Davis",
    Age = 20,
    Email = "emma@school.com"
};
</pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <h2 class="text-center">2. Courses Table</h2>
    
    <div class="table-section">
        <div class="table-visual">
            <div class="code-container">
                <div class="code-header">Courses Table - Stores Course Information</div>
                <div class="code-content">
<pre>
┌───────────┬────────────────────┬─────────┬─────────────┐
│ CourseID  │    CourseName      │ Credits │  TeacherID  │
├───────────┼────────────────────┼─────────┼─────────────┤
│   201     │  Mathematics       │    3    │     301     │
│   202     │  Computer Science  │    4    │     302     │
│   203     │  English Literature│    3    │     303     │
│   204     │  Physics           │    4    │     301     │
└───────────┴────────────────────┴─────────┴─────────────┘

<span style="color: #198754;">TeacherID is a foreign key linking to Teachers table</span>
</pre>
                </div>
            </div>
        </div>
        
        <div class="table-details">
            <div class="sql-code">
                <div class="code-container">
                    <div class="code-header">SQL to Create Courses Table</div>
                    <div class="code-content">
<pre>
CREATE TABLE Courses (
    CourseID INT PRIMARY KEY,             <span style="color: #198754;">← Unique course ID</span>
    CourseName VARCHAR(100) NOT NULL,     <span style="color: #198754;">← Course name required</span>
    Credits INT DEFAULT 3,                <span style="color: #198754;">← Default to 3 credits</span>
    TeacherID INT,                        <span style="color: #198754;">← Links to teacher</span>
    FOREIGN KEY (TeacherID) REFERENCES Teachers(TeacherID) <span style="color: #198754;">← Foreign key</span>
);
</pre>
                    </div>
                </div>
            </div>
            
            <div class="csharp-code">
                <div class="code-container">
                    <div class="code-header">C# Class for Courses</div>
                    <div class="code-content">
<pre>
public class Course
{
    public int CourseID { get; set; }     <span style="color: #198754;">← Primary Key</span>
    public string CourseName { get; set; }
    public int Credits { get; set; }
    public int TeacherID { get; set; }    <span style="color: #198754;">← Foreign Key</span>
    
    <span style="color: #198754;">// Navigation properties</span>
    public Teacher Teacher { get; set; }  <span style="color: #198754;">← Links to Teacher object</span>
    public ICollection&lt;Enrollment&gt; Enrollments { get; set; }
}

<span style="color: #198754;">// Creating a new course in C#</span>
var newCourse = new Course
{
    CourseID = 205,
    CourseName = "Database Fundamentals",
    Credits = 4,
    TeacherID = 302  <span style="color: #198754;">// Mr. Johnson teaches this</span>
};
</pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <h2 class="text-center">3. Enrollment Table (The Connection)</h2>
    
    <div class="table-section">
        <div class="table-visual">
            <div class="code-container">
                <div class="code-header">Enrollment Table - Connects Students to Courses</div>
                <div class="code-content">
<pre>
┌──────────────┬─────────────┬───────────┬───────┬──────────────┐
│ EnrollmentID │ StudentID   │ CourseID  │ Grade │    Date      │
├──────────────┼─────────────┼───────────┼───────┼──────────────┤
│      1       │    101      │    201    │   A   │ 2024-01-15   │
│      2       │    101      │    202    │   B   │ 2024-01-15   │
│      3       │    102      │    201    │   B+  │ 2024-01-16   │
│      4       │    103      │    203    │   A   │ 2024-01-16   │
│      5       │    104      │    204    │   C   │ 2024-01-17   │
└──────────────┴─────────────┴───────────┴───────┴──────────────┘

<span style="color: #198754;">This table creates MANY-TO-MANY relationship</span>
<span style="color: #198754;">One student can take many courses</span>
<span style="color: #198754;">One course can have many students</span>
</pre>
                </div>
            </div>
        </div>
        
        <div class="table-details">
            <div class="sql-code">
                <div class="code-container">
                    <div class="code-header">SQL to Create Enrollment Table</div>
                    <div class="code-content">
<pre>
CREATE TABLE Enrollment (
    EnrollmentID INT PRIMARY KEY,                  <span style="color: #198754;">← Unique enrollment ID</span>
    StudentID INT NOT NULL,                        <span style="color: #198754;">← Must have student</span>
    CourseID INT NOT NULL,                         <span style="color: #198754;">← Must have course</span>
    Grade CHAR(2) CHECK (Grade IN ('A','A-','B+','B','B-','C+','C','C-','D','F')),
    EnrollmentDate DATE DEFAULT GETDATE(),         <span style="color: #198754;">← Auto date</span>
    FOREIGN KEY (StudentID) REFERENCES Students(StudentID),
    FOREIGN KEY (CourseID) REFERENCES Courses(CourseID),
    UNIQUE (StudentID, CourseID)                  <span style="color: #198754;">← Prevents duplicate enrollments</span>
);
</pre>
                    </div>
                </div>
            </div>
            
            <div class="csharp-code">
                <div class="code-container">
                    <div class="code-header">C# Class for Enrollment</div>
                    <div class="code-content">
<pre>
public class Enrollment
{
    public int EnrollmentID { get; set; }  <span style="color: #198754;">← Primary Key</span>
    public int StudentID { get; set; }     <span style="color: #198754;">← Foreign Key to Student</span>
    public int CourseID { get; set; }      <span style="color: #198754;">← Foreign Key to Course</span>
    public string Grade { get; set; }
    public DateTime EnrollmentDate { get; set; }
    
    <span style="color: #198754;">// Navigation properties</span>
    public Student Student { get; set; }   <span style="color: #198754;">← Links to Student object</span>
    public Course Course { get; set; }     <span style="color: #198754;">← Links to Course object</span>
}

<span style="color: #198754;">// Enrolling a student in a course using C#</span>
var enrollment = new Enrollment
{
    StudentID = 101,      <span style="color: #198754;">// Alice</span>
    CourseID = 202,       <span style="color: #198754;">// Computer Science</span>
    Grade = "A"
};
</pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <h2 class="text-center">4. Teachers Table (Optional but Useful)</h2>
    
    <div class="table-section">
        <div class="table-visual">
            <div class="code-container">
                <div class="code-header">Teachers Table - Stores Teacher Information</div>
<div class="code-content">
<pre>
┌───────────┬─────────────┬───────────────┬──────────────┐
│ TeacherID │ FirstName   │  LastName     │  Department  │
├───────────┼─────────────┼───────────────┼──────────────┤
│    301    │   Sarah     │   Johnson     │  Mathematics │
│    302    │   David     │   Miller      │  Computer Sci│
│    303    │   Emily     │   Wilson      │  English     │
└───────────┴─────────────┴───────────────┴──────────────┘
</pre>
                </div>
            </div>
        </div>
        
        <div class="table-details">
            <div class="sql-code">
                <div class="code-container">
                    <div class="code-header">SQL to Create Teachers Table</div>
                    <div class="code-content">
<pre>
CREATE TABLE Teachers (
    TeacherID INT PRIMARY KEY,
    FirstName VARCHAR(50) NOT NULL,
    LastName VARCHAR(50) NOT NULL,
    Department VARCHAR(50),
    HireDate DATE DEFAULT GETDATE()
);
</pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <h2 class="text-center">Practical Database Queries</h2>
    
    <div class="queries-section">
        <div class="query-examples">
            <div class="query-card">
                <h4>1. Find All Students Taking Math</h4>
                <div class="code-container">
                    <div class="code-header">SQL Query</div>
                    <div class="code-content">
<pre>
SELECT s.FirstName, s.LastName
FROM Students s
JOIN Enrollment e ON s.StudentID = e.StudentID
JOIN Courses c ON e.CourseID = c.CourseID
WHERE c.CourseName = 'Mathematics';
</pre>
                    </div>
                </div>
                <div class="code-container">
                    <div class="code-header">C# Equivalent (Much Easier!)</div>
                    <div class="code-content">
<pre>
var mathStudents = dbContext.Students
    .Where(s => s.Enrollments
        .Any(e => e.Course.CourseName == "Mathematics"))
    .Select(s => new { s.FirstName, s.LastName })
    .ToList();

<span style="color: #198754;">// Result: Alice Smith, Bob Johnson</span>
</pre>
                    </div>
                </div>
            </div>
            
            <div class="query-card">
                <h4>2. Count Students in Each Course</h4>
                <div class="code-container">
                    <div class="code-header">SQL Query</div>
                    <div class="code-content">
<pre>
SELECT c.CourseName, COUNT(e.StudentID) AS StudentCount
FROM Courses c
LEFT JOIN Enrollment e ON c.CourseID = e.CourseID
GROUP BY c.CourseName;
</pre>
                    </div>
                </div>
                <div class="code-container">
                    <div class="code-header">C# Equivalent</div>
                    <div class="code-content">
<pre>
var courseCounts = dbContext.Courses
    .Select(c => new 
    {
        CourseName = c.CourseName,
        StudentCount = c.Enrollments.Count()
    })
    .ToList();

<span style="color: #198754;">// Result: Math (2), Computer Science (1), etc.</span>
</pre>
                    </div>
                </div>
            </div>
            
            <div class="query-card">
                <h4>3. Find Students with Grade A in Any Course</h4>
                <div class="code-container">
                    <div class="code-header">SQL Query</div>
                    <div class="code-content">
<pre>
SELECT DISTINCT s.FirstName, s.LastName
FROM Students s
JOIN Enrollment e ON s.StudentID = e.StudentID
WHERE e.Grade = 'A';
</pre>
                    </div>
                </div>
                <div class="code-container">
                    <div class="code-header">C# Equivalent</div>
                    <div class="code-content">
<pre>
var topStudents = dbContext.Students
    .Where(s => s.Enrollments.Any(e => e.Grade == "A"))
    .Select(s => new { s.FirstName, s.LastName })
    .Distinct()
    .ToList();

<span style="color: #198754;">// Result: Alice Smith, Charlie Williams</span>
</pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="benefits-section">
        <h3 class="text-center">Why This Database Design Is Excellent</h3>
        
        <div class="benefits-grid">
            <div class="benefit">
                <h4>No Data Duplication</h4>
                <p>Student information stored once, referenced everywhere with StudentID.</p>
            </div>
            
            <div class="benefit">
                <h4>Easy Updates</h4>
                <p>Change student email in ONE place (Students table), affects everywhere.</p>
            </div>
            
            <div class="benefit">
                <h4>Flexible Queries</h4>
                <p>Ask complex questions like "Which teachers have no students in their courses?"</p>
            </div>
            
            <div class="benefit">
                <h4>Data Integrity</h4>
                <p>Can't enroll non-existent student or course (foreign keys prevent this).</p>
            </div>
            
            <div class="benefit">
                <h4>Scalable</h4>
                <p>Add 10,000 more students without changing the structure.</p>
            </div>
            
            <div class="benefit">
                <h4>C# Friendly</h4>
                <p>Perfect match for Entity Framework and object-oriented programming.</p>
            </div>
        </div>
    </div>

    <div class="real-world-application">
        <h3 class="text-center">Real-World Application: School Portal</h3>
        
        <div class="application-flow">
            <div class="flow-step">
                <h5>Student Logs In</h5>
                <p><strong>Database action:</strong> Verify credentials from Students table</p>
            </div>
            
            <div class="flow-step">
                <h5>View Their Courses</h5>
                <p><strong>Database action:</strong> JOIN Students → Enrollment → Courses</p>
            </div>
            
            <div class="flow-step">
                <h5>Check Grades</h5>
                <p><strong>Database action:</strong> SELECT from Enrollment where StudentID = current student</p>
            </div>
            
            <div class="flow-step">
                <h5>Register for New Course</h5>
                <p><strong>Database action:</strong> INSERT into Enrollment table</p>
            </div>
            
            <div class="flow-step">
                <h5>Teacher Updates Grade</h5>
                <p><strong>Database action:</strong> UPDATE Enrollment SET Grade = 'A'</p>
            </div>
            
            <div class="flow-step">
                <h5>Admin Generates Report</h5>
                <p><strong>Database action:</strong> Complex queries with GROUP BY, JOIN, WHERE</p>
            </div>
        </div>
        
        <div class="csharp-implementation">
            <div class="code-container">
                <div class="code-header">Complete C# School Portal Example</div>
<div class="code-content">
<pre>
<span style="color: #198754;">// 1. Student views their courses</span>
public List&lt;Course&gt; GetStudentCourses(int studentId)
{
    return dbContext.Enrollments
        .Where(e => e.StudentID == studentId)
        .Select(e => e.Course)
        .ToList();
}

<span style="color: #198754;">// 2. Enroll student in new course</span>
public bool EnrollStudent(int studentId, int courseId)
{
    var enrollment = new Enrollment
    {
        StudentID = studentId,
        CourseID = courseId,
        EnrollmentDate = DateTime.Now
    };
    
    dbContext.Enrollments.Add(enrollment);
    dbContext.SaveChanges();
    return true;
}

<span style="color: #198754;">// 3. Get student transcript (all grades)</span>
public List&lt;TranscriptItem&gt; GetStudentTranscript(int studentId)
{
    return dbContext.Enrollments
        .Where(e => e.StudentID == studentId)
        .Select(e => new TranscriptItem
        {
            CourseName = e.Course.CourseName,
            Grade = e.Grade,
            Credits = e.Course.Credits
        })
        .ToList();
}
</pre>
                </div>
            </div>
        </div>
    </div>

    <div class="learning-summary">
        <h3 class="text-center">What You've Learned</h3>
        
        <div class="summary-content">
            <p><strong>This school database example demonstrates:</strong></p>
            <ol>
                <li><strong>Table Design:</strong> How to structure tables for real-world data</li>
                <li><strong>Relationships:</strong> Using foreign keys to connect tables</li>
                <li><strong>Many-to-Many:</strong> Enrollment table as a join table</li>
                <li><strong>Data Integrity:</strong> Using constraints to ensure valid data</li>
                <li><strong>C# Integration:</strong> How database tables become C# classes</li>
                <li><strong>Practical Queries:</strong> Real questions you'd ask of the data</li>
            </ol>
            <p><strong>Key Takeaway:</strong> Relational databases organize complex data into simple, connected tables. With C# and Entity Framework, you work with familiar objects instead of complex SQL!</p>
        </div>
    </div>

    <div class="navigation-buttons">
        <a href="@Url.Action("RelationalDatabase", "Database")" class="btn btn-outline-primary ajax-link">← Relational Databases</a>
        <a href="@Url.Action("Summary", "Database")" class="btn btn-primary ajax-link">Next: Chapter Summary →</a>
    </div>
</div>

<style>
    .container {
        max-width: 800px;
        padding: 20px;
        background-color: var(--bs-body-bg);
    }

    h1, h2, h3, h4, h5 {
        color: var(--bs-heading-color);
        margin-bottom: 15px;
    }

    h1 {
        border-bottom: 2px solid var(--bs-primary);
        padding-bottom: 10px;
    }

    h2 {
        margin-top: 40px;
        padding-bottom: 8px;
        border-bottom: 1px solid var(--bs-border-color);
    }

    h2.text-center {
        text-align: center;
        margin-top: 50px;
    }

    p, li {
        color: var(--bs-body-color);
        line-height: 1.6;
    }

    .intro-section {
        margin-bottom: 30px;
    }

    .real-world-context {
        padding: 15px;
        background-color: rgba(255, 193, 7, 0.1);
        border: 1px solid var(--bs-warning);
        border-radius: 5px;
        margin-top: 15px;
    }

    .database-overview {
        margin: 30px 0;
    }

    .schema-diagram {
        margin-bottom: 20px;
    }

    .schema-explanation {
        padding: 15px;
        background-color: rgba(0, 123, 255, 0.05);
        border-radius: 5px;
    }

    .explanation-point h4 {
        color: var(--bs-primary);
        margin-top: 0;
    }

    .explanation-point ul {
        margin-left: 20px;
    }

    .code-container {
        margin: 15px 0;
        border: 1px solid var(--bs-border-color);
        border-radius: 5px;
        overflow: hidden;
        background-color: #1a1a1a;
    }

    .code-header {
        background-color: #2d2d2d;
        padding: 10px 15px;
        border-bottom: 1px solid var(--bs-border-color);
        font-family: 'SFMono-Regular', Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        font-size: 0.9rem;
        color: #e0e0e0;
    }

    .code-content {
        padding: 15px;
        overflow-x: auto;
    }

    pre {
        margin: 0;
        white-space: pre-wrap;
        background-color: transparent;
        font-family: 'SFMono-Regular', Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        color: #e0e0e0;
        line-height: 1.4;
    }

    .table-section {
        margin: 40px 0;
    }

    .table-visual {
        margin-bottom: 20px;
    }

    .table-details {
        display: grid;
        grid-template-columns: 1fr;
        gap: 20px;
    }

    @@media (min-width: 768px) {
        .table-details {
            grid-template-columns: 1fr 1fr;
        }
    }

    .sql-code, .csharp-code {
        margin-bottom: 15px;
    }

    .queries-section {
        margin: 40px 0;
    }

    .query-examples {
        display: grid;
        grid-template-columns: 1fr;
        gap: 30px;
    }

    .query-card {
        padding: 20px;
        background-color: rgba(111, 66, 193, 0.1);
        border: 1px solid var(--bs-indigo);
        border-radius: 8px;
    }

    .query-card h4 {
        color: var(--bs-indigo);
        margin-top: 0;
        border-bottom: 1px solid var(--bs-border-color);
        padding-bottom: 10px;
    }

    .benefits-section {
        margin: 40px 0;
    }

    .benefits-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }

    .benefit {
        padding: 15px;
        background-color: rgba(40, 167, 69, 0.1);
        border: 1px solid var(--bs-success);
        border-radius: 5px;
        text-align: center;
    }

    .benefit h4 {
        color: var(--bs-success);
        margin-top: 0;
    }

    .real-world-application {
        margin: 40px 0;
    }

    .application-flow {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin: 20px 0;
    }

    .flow-step {
        padding: 15px;
        background-color: rgba(255, 193, 7, 0.1);
        border: 1px solid var(--bs-warning);
        border-radius: 5px;
        text-align: center;
    }

    .flow-step h5 {
        color: var(--bs-warning);
        margin-top: 0;
    }

    .csharp-implementation {
        margin-top: 30px;
    }

    .learning-summary {
        margin: 40px 0;
        padding: 20px;
        background-color: rgba(111, 66, 193, 0.1);
        border: 1px solid var(--bs-indigo);
        border-radius: 8px;
    }

    .learning-summary h3 {
        color: var(--bs-indigo);
    }

    .summary-content {
        margin-top: 15px;
    }

    .summary-content ol {
        margin-left: 20px;
    }

    .navigation-buttons {
        display: flex;
        justify-content: space-between;
        margin-top: 30px;
    }

    .btn {
        padding: 8px 20px;
        border-radius: 4px;
        font-weight: 500;
        text-decoration: none;
    }

    .btn-primary {
        background-color: var(--bs-primary);
        border-color: var(--bs-primary);
        color: #fff;
    }

    .btn-outline-primary {
        color: var(--bs-primary);
        border-color: var(--bs-primary);
        background-color: transparent;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        if (typeof hljs !== 'undefined') {
            hljs.highlightAll();
        }
    });
</script>
</body>