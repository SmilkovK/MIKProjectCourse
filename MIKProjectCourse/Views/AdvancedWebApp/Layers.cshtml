@{
    ViewData["Title"] = "Understanding .NET Application Layers";
}

<div class="container">
    <h1 class="text-center">Understanding .NET Application Layers</h1>

    <div class="beginner-note">
        <div class="beginner-note-icon">
            <i class="fas fa-layer-group"></i>
        </div>
        <div class="beginner-note-content">
            <h4>Think of Layers Like a Restaurant Kitchen</h4>
            <p><strong>Application Layers = Different stations in a kitchen</strong></p>
            <p><strong>Simple analogy:</strong></p>
            <ul>
                <li><strong>Customer (Frontend)</strong> = Person ordering food</li>
                <li><strong>Waiter (Controller Layer)</strong> = Takes order to kitchen</li>
                <li><strong>Chef (Service Layer)</strong> = Prepares the meal with recipes</li>
                <li><strong>Pantry (Repository Layer)</strong> = Gets ingredients from storage</li>
                <li><strong>Refrigerator (Database)</strong> = Where ingredients are stored</li>
            </ul>
            <p><strong>In web terms:</strong> Each layer has one specific job, making your code clean and organized!</p>
        </div>
    </div>

    <div class="important-note">
        <h4><i class="fas fa-star"></i> Good News for Beginners</h4>
        <p>You already understand this concept from real life! Think about how restaurants, offices, or schools are organized. Everyone has a specific job, and work flows from one person/department to another. That's exactly what layers are in programming!</p>
    </div>

    <div class="intro-section">
        <p>In the previous sections, you learned about MVC (Model-View-Controller). Now we're going to expand that idea into a more organized structure called <strong>layered architecture</strong>. This is how professional developers build applications that are easy to maintain, test, and expand.</p>
        
        <div class="alert alert-info">
            <i class="fas fa-lightbulb"></i> <strong>Why layers?</strong> Imagine if the chef also had to greet customers, take orders, and clean tables. Everything would be chaotic! Layers keep everything organized, just like in a well-run restaurant.
        </div>
    </div>

    <h2 class="text-center">The Three Main Layers</h2>
    
    <div class="layers-visual">
        <div class="layer-container">
            <div class="layer-item controller-layer">
                <div class="layer-header">
                    <div class="layer-icon">
                        <i class="fas fa-traffic-light"></i>
                    </div>
                    <h3>Controller Layer</h3>
                    <div class="layer-badge">1st Layer</div>
                </div>
                <div class="layer-content">
                    <p><strong>The Waiter</strong> - Handles communication between user and application</p>
                    <div class="layer-responsibilities">
                        <div class="responsibility">
                            <i class="fas fa-check-circle"></i>
                            <span>Receives HTTP requests (URL clicks, form submissions)</span>
                        </div>
                        <div class="responsibility">
                            <i class="fas fa-check-circle"></i>
                            <span>Validates user input (checks if email looks right)</span>
                        </div>
                        <div class="responsibility">
                            <i class="fas fa-check-circle"></i>
                            <span>Calls the Service Layer to do actual work</span>
                        </div>
                        <div class="responsibility">
                            <i class="fas fa-check-circle"></i>
                            <span>Sends response back to user (shows a page)</span>
                        </div>
                    </div>
                    <div class="code-example">
                        <div class="example-header">
                            <i class="fas fa-code"></i> Controller Example
                        </div>
<pre><code class="language-csharp">public class ProductController : Controller
{
    private readonly IProductService _productService;
    
    // Constructor gets the service (dependency injection)
    public ProductController(IProductService productService)
    {
        _productService = productService;
    }
    
    // Action method - handles /products/details/5
    public IActionResult Details(int id)
    {
        // Ask service layer for product details
        var product = _productService.GetProductById(id);
        
        // Show the product view
        return View(product);
    }
}</code></pre>
                    </div>
                </div>
            </div>
            
            <div class="layer-arrow">
                <i class="fas fa-arrow-down"></i>
            </div>
            
            <div class="layer-item service-layer">
                <div class="layer-header">
                    <div class="layer-icon">
                        <i class="fas fa-cogs"></i>
                    </div>
                    <h3>Service Layer</h3>
                    <div class="layer-badge">2nd Layer</div>
                </div>
                <div class="layer-content">
                    <p><strong>The Chef</strong> - Contains the business logic and rules</p>
                    <div class="layer-responsibilities">
                        <div class="responsibility">
                            <i class="fas fa-check-circle"></i>
                            <span>Contains application logic (how things should work)</span>
                        </div>
                        <div class="responsibility">
                            <i class="fas fa-check-circle"></i>
                            <span>Enforces business rules (can't order if out of stock)</span>
                        </div>
                        <div class="responsibility">
                            <i class="fas fa-check-circle"></i>
                            <span>Processes data before saving or displaying</span>
                        </div>
                        <div class="responsibility">
                            <i class="fas fa-check-circle"></i>
                            <span>Calls Repository Layer to get/save data</span>
                        </div>
                    </div>
                    <div class="code-example">
                        <div class="example-header">
                            <i class="fas fa-code"></i> Service Example
                        </div>
<pre><code class="language-csharp">public class ProductService : IProductService
{
    private readonly IProductRepository _productRepository;
    
    public ProductService(IProductRepository productRepository)
    {
        _productRepository = productRepository;
    }
    
    public Product GetProductById(int id)
    {
        // Business logic: Check if product exists
        var product = _productRepository.GetById(id);
        
        if (product == null)
        {
            throw new Exception("Product not found!");
        }
        
        // Business logic: Add discount if product is old
        if (product.AddedDate < DateTime.Now.AddMonths(-6))
        {
            product.Price *= 0.8m; // 20% discount
        }
        
        return product;
    }
}</code></pre>
                    </div>
                </div>
            </div>
            
            <div class="layer-arrow">
                <i class="fas fa-arrow-down"></i>
            </div>
            
            <div class="layer-item repository-layer">
                <div class="layer-header">
                    <div class="layer-icon">
                        <i class="fas fa-database"></i>
                    </div>
                    <h3>Repository Layer</h3>
                    <div class="layer-badge">3rd Layer</div>
                </div>
                <div class="layer-content">
                    <p><strong>The Pantry Worker</strong> - Manages all database operations</p>
                    <div class="layer-responsibilities">
                        <div class="responsibility">
                            <i class="fas fa-check-circle"></i>
                            <span>Only talks to the database</span>
                        </div>
                        <div class="responsibility">
                            <i class="fas fa-check-circle"></i>
                            <span>Performs CRUD operations (Create, Read, Update, Delete)</span>
                        </div>
                        <div class="responsibility">
                            <i class="fas fa-check-circle"></i>
                            <span>Doesn't know business rules - just gets/saves data</span>
                        </div>
                        <div class="responsibility">
                            <i class="fas fa-check-circle"></i>
                            <span>Uses Entity Framework to work with database</span>
                        </div>
                    </div>
                    <div class="code-example">
                        <div class="example-header">
                            <i class="fas fa-code"></i> Repository Example
                        </div>
<pre><code class="language-csharp">public class ProductRepository : IProductRepository
{
    private readonly ApplicationDbContext _context;
    
    public ProductRepository(ApplicationDbContext context)
    {
        _context = context;
    }
    
    public Product GetById(int id)
    {
        // Simple database query - no business logic
        return _context.Products.FirstOrDefault(p => p.Id == id);
    }
    
    public void Add(Product product)
    {
        // Simple save to database
        _context.Products.Add(product);
        _context.SaveChanges();
    }
    
    public List<Product> GetAll()
    {
        // Get all products from database
        return _context.Products.ToList();
    }
}</code></pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="interactive-exercise">
        <h3><i class="fas fa-gamepad"></i> Let's Trace the Flow!</h3>
        <p>Follow what happens when a user wants to see product details:</p>
        
        <div class="flow-trace">
            <div class="trace-step">
                <div class="step-number">1</div>
                <div class="step-content">
                    <h5>User Clicks</h5>
                    <p>User visits <code>/products/details/5</code></p>
                    <div class="step-note">This goes to ProductController.Details(5)</div>
                </div>
                <div class="trace-arrow">→</div>
            </div>
            
            <div class="trace-step">
                <div class="step-number">2</div>
                <div class="step-content">
                    <h5>Controller</h5>
                    <p>Controller asks Service: "Get me product #5"</p>
                    <div class="step-note"><code>productService.GetProductById(5)</code></div>
                </div>
                <div class="trace-arrow">→</div>
            </div>
            
            <div class="trace-step">
                <div class="step-number">3</div>
                <div class="step-content">
                    <h5>Service</h5>
                    <p>Service asks Repository: "Get product #5 from database"</p>
                    <div class="step-note">Then applies 20% discount if product is old</div>
                </div>
                <div class="trace-arrow">→</div>
            </div>
            
            <div class="trace-step">
                <div class="step-number">4</div>
                <div class="step-content">
                    <h5>Repository</h5>
                    <p>Repository gets product from database</p>
                    <div class="step-note">Simple SQL query: <code>SELECT * FROM Products WHERE Id = 5</code></div>
                </div>
                <div class="trace-arrow">←</div>
            </div>
            
            <div class="trace-step">
                <div class="step-number">5</div>
                <div class="step-content">
                    <h5>Back to Service</h5>
                    <p>Service receives data, applies discount, returns to Controller</p>
                </div>
                <div class="trace-arrow">←</div>
            </div>
            
            <div class="trace-step">
                <div class="step-number">6</div>
                <div class="step-content">
                    <h5>Back to Controller</h5>
                    <p>Controller passes product to View</p>
                </div>
                <div class="trace-arrow">→</div>
            </div>
            
            <div class="trace-step">
                <div class="step-number">7</div>
                <div class="step-content">
                    <h5>User Sees Result</h5>
                    <p>Browser shows product page with discounted price!</p>
                </div>
            </div>
        </div>
    </div>

    <div class="key-points">
        <h3>Why This Organization Rocks!</h3>
        <ul>
            <li><strong>Separation of Concerns:</strong> Each layer does ONE job really well</li>
            <li><strong>Easy Maintenance:</strong> If database changes, only Repository layer needs updating</li>
            <li><strong>Easy Testing:</strong> Can test Service logic without needing a real database</li>
            <li><strong>Team Collaboration:</strong> Different developers can work on different layers</li>
            <li><strong>Code Reusability:</strong> Same Service can be used by Web API and Web App</li>
            <li><strong>Clean Code:</strong> Everything is organized and easy to find</li>
        </ul>
    </div>

    <div class="restaurant-analogy">
        <h3><i class="fas fa-utensils"></i> Restaurant Analogy in Detail</h3>
        <div class="analogy-grid">
            <div class="analogy-item">
                <div class="analogy-header">
                    <div class="analogy-icon">
                        <i class="fas fa-user-tie"></i>
                    </div>
                    <h5>Waiter (Controller)</h5>
                </div>
                <p>Doesn't cook food, just takes order to kitchen and brings food to customer. If customer wants extra ketchup, waiter doesn't make it - asks kitchen!</p>
            </div>
            
            <div class="analogy-item">
                <div class="analogy-header">
                    <div class="analogy-icon">
                        <i class="fas fa-user-chef"></i>
                    </div>
                    <h5>Chef (Service)</h5>
                </div>
                <p>Knows recipes, decides how to cook, adds special seasoning. Doesn't get ingredients from storage - asks pantry worker!</p>
            </div>
            
            <div class="analogy-item">
                <div class="analogy-header">
                    <div class="analogy-icon">
                        <i class="fas fa-box-open"></i>
                    </div>
                    <h5>Pantry Worker (Repository)</h5>
                </div>
                <p>Only job: get ingredients from refrigerator when asked. Doesn't decide recipes, just fetches what's needed.</p>
            </div>
            
            <div class="analogy-item">
                <div class="analogy-header">
                    <div class="analogy-icon">
                        <i class="fas fa-refrigerator"></i>
                    </div>
                    <h5>Refrigerator (Database)</h5>
                </div>
                <p>Just stores ingredients. Doesn't know what they're used for, just keeps them organized and fresh.</p>
            </div>
        </div>
    </div>

    <div class="navigation-buttons">
        <a href="@Url.Action("Introduction", "AdvancedWebApp")" class="btn btn-outline-primary ajax-link" data-path="/AdvancedWebApp/Introduction">← Back: Introduction</a>
        <a href="@Url.Action("ControllerLayer", "AdvancedWebApp")" class="btn btn-primary ajax-link" data-path="/AdvancedWebApp/ControllerLayer">Next: Controller Layer Details →</a>
    </div>
</div>

<style>
    .container { 
        max-width: 900px; 
        padding: 20px; 
        background-color: var(--bs-body-bg); 
    }
    
    h1, h2, h3, h4, h5 { 
        color: var(--bs-heading-color); 
        margin-bottom: 15px; 
    }
    
    h1 { 
        border-bottom: 2px solid var(--bs-primary); 
        padding-bottom: 10px; 
    }
    
    .beginner-note {
        background-color: rgba(13, 110, 253, 0.1);
        border: 2px solid var(--bs-primary);
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 30px;
        display: flex;
        gap: 15px;
        align-items: flex-start;
    }
    
    .beginner-note-icon {
        background-color: var(--bs-primary);
        color: white;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        flex-shrink: 0;
    }
    
    .important-note {
        background-color: rgba(255, 193, 7, 0.2);
        border: 2px solid var(--bs-warning);
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 30px;
    }
    
    .important-note h4 {
        color: var(--bs-warning);
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .intro-section {
        margin-bottom: 40px;
        padding: 20px;
        background-color: rgba(108, 117, 125, 0.1);
        border-radius: 8px;
    }

    .layers-visual {
        margin: 40px 0;
    }
    
    .layer-container {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }
    
    .layer-item {
        border: 2px solid var(--bs-border-color);
        border-radius: 10px;
        padding: 20px;
        transition: all 0.3s;
    }
    
    .layer-item:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0,0,0,0.1);
    }
    
    .controller-layer {
        border-left: 5px solid #007bff;
    }
    
    .service-layer {
        border-left: 5px solid #28a745;
    }
    
    .repository-layer {
        border-left: 5px solid #6f42c1;
    }
    
    .layer-header {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 20px;
    }
    
    .layer-icon {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        color: white;
    }
    
    .controller-layer .layer-icon {
        background-color: #007bff;
    }
    
    .service-layer .layer-icon {
        background-color: #28a745;
    }
    
    .repository-layer .layer-icon {
        background-color: #6f42c1;
    }
    
    .layer-header h3 {
        margin: 0;
        flex: 1;
    }
    
    .layer-badge {
        background-color: var(--bs-dark);
        color: white;
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 0.9rem;
        font-weight: bold;
    }
    
    .layer-responsibilities {
        margin: 15px 0;
    }
    
    .responsibility {
        display: flex;
        gap: 10px;
        align-items: flex-start;
        margin-bottom: 10px;
    }
    
    .responsibility i {
        color: var(--bs-success);
        margin-top: 3px;
        flex-shrink: 0;
    }
    
    .code-example {
        margin-top: 20px;
        background-color: #1a1a1a;
        border-radius: 8px;
        overflow: hidden;
    }
    
    .example-header {
        background-color: #2d2d2d;
        padding: 10px 15px;
        color: #e0e0e0;
        font-weight: bold;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .layer-arrow {
        text-align: center;
        color: var(--bs-primary);
        font-size: 2rem;
        margin: 10px 0;
    }

    .interactive-exercise {
        margin: 40px 0;
        padding: 25px;
        background-color: rgba(255, 193, 7, 0.1);
        border: 1px solid var(--bs-warning);
        border-radius: 10px;
    }
    
    .flow-trace {
        display: flex;
        flex-direction: column;
        gap: 15px;
        margin-top: 20px;
    }
    
    .trace-step {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 15px;
        background-color: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
        border-left: 4px solid var(--bs-info);
    }
    
    .step-number {
        background-color: var(--bs-info);
        color: white;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 1.2rem;
        flex-shrink: 0;
    }
    
    .trace-arrow {
        color: var(--bs-info);
        font-size: 1.5rem;
        font-weight: bold;
        flex-shrink: 0;
    }
    
    .step-note {
        margin-top: 5px;
        font-size: 0.9rem;
        color: var(--bs-secondary);
        font-style: italic;
    }
    
    .key-points {
        margin: 40px 0;
        padding: 25px;
        background-color: rgba(13, 110, 253, 0.1);
        border: 1px solid var(--bs-primary);
        border-radius: 10px;
    }
    
    .key-points ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    
    .key-points li {
        padding: 10px 0;
        border-bottom: 1px solid rgba(13, 110, 253, 0.2);
        position: relative;
        padding-left: 30px;
    }
    
    .key-points li:before {
        content: "✓";
        position: absolute;
        left: 0;
        color: var(--bs-success);
        font-weight: bold;
        font-size: 1.1rem;
    }
    
    .key-points li:last-child {
        border-bottom: none;
    }
    
    .restaurant-analogy {
        margin: 40px 0;
        padding: 25px;
        background-color: rgba(108, 117, 125, 0.1);
        border: 1px solid var(--bs-secondary);
        border-radius: 10px;
    }
    
    .analogy-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }
    
    .analogy-item {
        padding: 15px;
        background-color: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
    }
    
    .analogy-header {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 10px;
    }
    
    .analogy-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background-color: var(--bs-warning);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
    }
    
    .navigation-buttons {
        display: flex;
        justify-content: space-between;
        margin-top: 40px;
        padding-top: 20px;
        border-top: 2px solid var(--bs-border-color);
    }
    
    .btn {
        padding: 12px 25px;
        border-radius: 6px;
        font-weight: 500;
        transition: all 0.3s;
    }
    
    .btn:hover {
        transform: translateY(-2px);
    }
    
    @@media (max-width: 768px) {
        .beginner-note {
            flex-direction: column;
            text-align: center;
        }
        
        .layer-header {
            flex-direction: column;
            text-align: center;
        }
        
        .trace-step {
            flex-direction: column;
            text-align: center;
        }
        
        .trace-arrow {
            transform: rotate(90deg);
        }
        
        .navigation-buttons {
            flex-direction: column;
            gap: 10px;
        }
        
        .navigation-buttons .btn {
            width: 100%;
            text-align: center;
        }
    }
</style>

<script>
$(document).ready(function() {
    if (typeof hljs !== 'undefined') {
        hljs.highlightAll();
    }
    
    $('.layer-item').hover(
        function() {
            $(this).css('box-shadow', '0 15px 30px rgba(0,0,0,0.15)');
        },
        function() {
            $(this).css('box-shadow', 'none');
        }
    );
    
    const traceSteps = $('.trace-step');
    traceSteps.each(function(index) {
        $(this).css({
            'opacity': '0',
            'transform': 'translateX(20px)',
            'transition': 'all 0.5s ease ' + (index * 0.2) + 's'
        });
    });
    
    setTimeout(() => {
        traceSteps.each(function(index) {
            $(this).css({
                'opacity': '1',
                'transform': 'translateX(0)'
            });
        });
    }, 300);
    
    $('.navigation-buttons a').addClass('ajax-link');
});
</script>