@{
    ViewData["Title"] = "Service Layer - The Chef";
}

<div class="container">
    <h1 class="text-center">Service Layer: The Chef of Your Application</h1>

    <div class="beginner-note">
        <div class="beginner-note-icon">
            <i class="fas fa-cogs"></i>
        </div>
        <div class="beginner-note-content">
            <h4>Remember the Restaurant Analogy!</h4>
            <p><strong>Service Layer = Chef in a restaurant</strong></p>
            <ul>
                <li><strong>Knows recipes:</strong> Contains all business rules and logic</li>
                <li><strong>Coordinates work:</strong> Tells pantry worker what ingredients to get</li>
                <li><strong>Doesn't serve customers:</strong> Never talks directly to users</li>
                <li><strong>Doesn't get ingredients:</strong> Never goes to the refrigerator</li>
                <li><strong>Just cooks:</strong> Focuses on preparing the meal correctly</li>
            </ul>
            <p><strong>In web terms:</strong> The Service Layer contains all your business logic. It's where the "real work" happens in your application!</p>
        </div>
    </div>

    <div class="important-note">
        <h4><i class="fas fa-star"></i> The Heart of Your Application</h4>
        <p>The Service Layer is where you put all the rules that make your application unique. Think of it as the "brain" of your application - it knows how things should work according to your business requirements.</p>
    </div>

    <div class="intro-section">
        <h2>What Services REALLY Do</h2>
        <p>Services contain the business logic that makes your application valuable. They're the layer that understands the "why" behind operations.</p>
        
        <div class="service-responsibilities">
            <div class="responsibility-grid">
                <div class="responsibility-item">
                    <div class="responsibility-icon">
                        <i class="fas fa-balance-scale"></i>
                    </div>
                    <h5>Business Rules</h5>
                    <p>Enforce company policies and rules</p>
                </div>
                
                <div class="responsibility-item">
                    <div class="responsibility-icon">
                        <i class="fas fa-calculator"></i>
                    </div>
                    <h5>Calculations</h5>
                    <p>Perform all calculations and logic</p>
                </div>
                
                <div class="responsibility-item">
                    <div class="responsibility-icon">
                        <i class="fas fa-exchange-alt"></i>
                    </div>
                    <h5>Coordination</h5>
                    <p>Coordinate between repositories</p>
                </div>
                
                <div class="responsibility-item">
                    <div class="responsibility-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <h5>Validation</h5>
                    <p>Validate business constraints</p>
                </div>
            </div>
        </div>
    </div>

    <div class="code-section">
        <h2>Service Layer Code Examples</h2>
        <p>Services coordinate work and enforce business rules. Here's what they look like in practice:</p>
        
        <div class="example-tabs">
            <div class="tab-buttons">
                <button class="tab-button active" data-tab="basic">Basic Service</button>
                <button class="tab-button" data-tab="complex">Complex Service</button>
                <button class="tab-button" data-tab="validation">Validation Service</button>
            </div>
            
            <div class="tab-content active" id="basic-tab">
                <div class="code-explanation">
                    <h5><i class="fas fa-utensils"></i> Simple Product Service</h5>
                    <p>This service handles basic product operations with simple business rules:</p>
                </div>
<pre><code class="language-csharp">public class ProductService : IProductService
{
    private readonly IProductRepository _productRepository;
    
    public ProductService(IProductRepository productRepository)
    {
        _productRepository = productRepository;
    }
    
    public Product GetProductWithDiscount(int productId)
    {
        // 1. Get product from repository
        var product = _productRepository.GetById(productId);
        
        // 2. Business logic: Apply discount if product is old
        if (product.CreatedDate < DateTime.Now.AddYears(-1))
        {
            product.Price *= 0.8m; // 20% discount
        }
        
        // 3. Business logic: Add tax
        product.Price *= 1.1m; // 10% tax
        
        return product;
    }
    
    public IEnumerable&lt;Product&gt; GetProductsForUser(string userId)
    {
        // Business logic: Get only products available for this user
        var allProducts = _productRepository.GetAll();
        
        // Filter based on user-specific rules
        return allProducts.Where(p => 
            p.IsActive && 
            (p.IsPremium == false || UserHasPremiumAccess(userId))
        );
    }
    
    private bool UserHasPremiumAccess(string userId)
    {
        // More business logic
        // This could check user subscription, permissions, etc.
        return true; // Simplified for example
    }
}</code></pre>
            </div>
            
            <div class="tab-content" id="complex-tab">
                <div class="code-explanation">
                    <h5><i class="fas fa-chef-hat"></i> Complex Order Service</h5>
                    <p>This service handles more complex operations involving multiple repositories and business rules:</p>
                </div>
<pre><code class="language-csharp">public class OrderService : IOrderService
{
    private readonly IOrderRepository _orderRepository;
    private readonly IProductRepository _productRepository;
    private readonly IUserRepository _userRepository;
    
    public OrderService(
        IOrderRepository orderRepository,
        IProductRepository productRepository,
        IUserRepository userRepository)
    {
        _orderRepository = orderRepository;
        _productRepository = productRepository;
        _userRepository = userRepository;
    }
    
    public OrderResult PlaceOrder(OrderRequest request)
    {
        // 1. Validate business rules
        if (!IsOrderValid(request))
        {
            throw new BusinessException("Invalid order request");
        }
        
        // 2. Get all necessary data
        var user = _userRepository.GetById(request.UserId);
        var products = _productRepository.GetByIds(request.ProductIds);
        
        // 3. Apply business logic: Calculate totals
        decimal subtotal = products.Sum(p => p.Price);
        decimal tax = CalculateTax(subtotal, user.Country);
        decimal shipping = CalculateShipping(products, user.Address);
        decimal discount = CalculateDiscount(user, subtotal);
        decimal total = subtotal + tax + shipping - discount;
        
        // 4. Create order entity
        var order = new Order
        {
            UserId = user.Id,
            OrderDate = DateTime.UtcNow,
            Status = OrderStatus.Pending,
            Subtotal = subtotal,
            Tax = tax,
            Shipping = shipping,
            Discount = discount,
            Total = total,
            Items = products.Select(p => new OrderItem
            {
                ProductId = p.Id,
                Price = p.Price,
                Quantity = 1
            }).ToList()
        };
        
        // 5. More business logic: Check inventory
        foreach (var product in products)
        {
            if (product.Stock < 1)
            {
                throw new BusinessException($"{product.Name} is out of stock");
            }
            product.Stock -= 1;
            _productRepository.Update(product);
        }
        
        // 6. Save everything
        _orderRepository.Add(order);
        
        // 7. Return result with business-specific information
        return new OrderResult
        {
            OrderId = order.Id,
            Success = true,
            Message = "Order placed successfully",
            EstimatedDelivery = DateTime.UtcNow.AddDays(3)
        };
    }
    
    private bool IsOrderValid(OrderRequest request)
    {
        // Complex business validation rules
        return request.ProductIds.Any() && 
               request.UserId > 0;
    }
    
    private decimal CalculateTax(decimal amount, string country)
    {
        // Business logic for tax calculation
        return country switch
        {
            "US" => amount * 0.07m,
            "CA" => amount * 0.13m,
            "UK" => amount * 0.20m,
            _ => amount * 0.10m // Default
        };
    }
    
    private decimal CalculateShipping(IEnumerable&lt;Product&gt; products, Address address)
    {
        // Business logic for shipping calculation
        decimal weight = products.Sum(p => p.Weight);
        bool isInternational = address.Country != "US";
        
        if (weight < 1) return isInternational ? 15 : 5;
        if (weight < 5) return isInternational ? 25 : 10;
        return isInternational ? 50 : 20;
    }
    
    private decimal CalculateDiscount(User user, decimal subtotal)
    {
        // Business logic for discount calculation
        decimal discount = 0;
        
        // Loyalty discount
        if (user.IsLoyalCustomer && user.AccountAge > 365)
        {
            discount += subtotal * 0.10m; // 10% loyalty discount
        }
        
        // First order discount
        if (user.TotalOrders == 0)
        {
            discount += 10; // $10 off first order
        }
        
        // Bulk discount
        if (subtotal > 100)
        {
            discount += subtotal * 0.05m; // 5% bulk discount
        }
        
        return Math.Min(discount, subtotal * 0.50m); // Cap at 50%
    }
}</code></pre>
            </div>
            
            <div class="tab-content" id="validation-tab">
                <div class="code-explanation">
                    <h5><i class="fas fa-clipboard-check"></i> Validation Service</h5>
                    <p>Services often handle complex validation that goes beyond simple field checks:</p>
                </div>
<pre><code class="language-csharp">public class UserService : IUserService
{
    private readonly IUserRepository _userRepository;
    
    public UserService(IUserRepository userRepository)
    {
        _userRepository = userRepository;
    }
    
    public RegistrationResult RegisterUser(UserRegistrationDto dto)
    {
        // Business validation rules
        var validationErrors = new List<string>();
        
        // 1. Check email format (business rule)
        if (!IsValidEmail(dto.Email))
        {
            validationErrors.Add("Invalid email format");
        }
        
        // 2. Check if email exists (business rule)
        if (_userRepository.EmailExists(dto.Email))
        {
            validationErrors.Add("Email already registered");
        }
        
        // 3. Check password strength (business rule)
        if (!IsStrongPassword(dto.Password))
        {
            validationErrors.Add("Password must be at least 8 characters with uppercase, lowercase, and numbers");
        }
        
        // 4. Age verification (business rule)
        if (CalculateAge(dto.BirthDate) < 13)
        {
            validationErrors.Add("Must be at least 13 years old");
        }
        
        // 5. Country restrictions (business rule)
        if (IsRestrictedCountry(dto.Country))
        {
            validationErrors.Add("Service not available in your country");
        }
        
        if (validationErrors.Any())
        {
            return new RegistrationResult
            {
                Success = false,
                Errors = validationErrors
            };
        }
        
        // All business rules passed - create user
        var user = new User
        {
            Email = dto.Email,
            PasswordHash = HashPassword(dto.Password),
            BirthDate = dto.BirthDate,
            Country = dto.Country,
            CreatedDate = DateTime.UtcNow,
            Status = UserStatus.Active
        };
        
        // Apply business logic for new users
        user.FreeTrialEndDate = DateTime.UtcNow.AddDays(30);
        user.WelcomeEmailSent = false;
        
        _userRepository.Add(user);
        
        return new RegistrationResult
        {
            Success = true,
            UserId = user.Id,
            Message = "Registration successful. 30-day free trial started."
        };
    }
    
    private bool IsValidEmail(string email)
    {
        // Business rule for email validation
        return !string.IsNullOrEmpty(email) &&
               email.Length <= 254 &&
               !email.Contains(" ") &&
               email.Count(c => c == '@@') == 1;
    }
    
    private bool IsStrongPassword(string password)
    {
        // Business rule for password strength
        return password.Length >= 8 &&
               password.Any(char.IsUpper) &&
               password.Any(char.IsLower) &&
               password.Any(char.IsDigit);
    }
    
    private int CalculateAge(DateTime birthDate)
    {
        // Business logic for age calculation
        var today = DateTime.Today;
        var age = today.Year - birthDate.Year;
        if (birthDate.Date > today.AddYears(-age)) age--;
        return age;
    }
    
    private bool IsRestrictedCountry(string country)
    {
        // Business rule for country restrictions
        var restrictedCountries = new[] { "CU", "IR", "KP", "SY" };
        return restrictedCountries.Contains(country);
    }
    
    private string HashPassword(string password)
    {
        // Business logic for password hashing
        // (In reality, use BCrypt or similar)
        return Convert.ToBase64String(Encoding.UTF8.GetBytes(password));
    }
}</code></pre>
            </div>
        </div>
    </div>

    <div class="service-characteristics">
        <h2><i class="fas fa-list-check"></i> What Makes a Good Service</h2>
        
        <div class="characteristics-grid">
            <div class="characteristic good">
                <div class="characteristic-header">
                    <i class="fas fa-check"></i>
                    <h5>DO These</h5>
                </div>
                <ul>
                    <li><strong>Contain business logic only</strong> - Rules that make your app unique</li>
                    <li><strong>Coordinate between repositories</strong> - Get data from multiple sources</li>
                    <li><strong>Handle complex calculations</strong> - Discounts, taxes, shipping</li>
                    <li><strong>Enforce business rules</strong> - Age limits, country restrictions</li>
                    <li><strong>Return business objects</strong> - Results tailored to business needs</li>
                    <li><strong>Handle transactions</strong> - Ensure data consistency</li>
                    <li><strong>Log business events</strong> - For auditing and analytics</li>
                </ul>
            </div>
            
            <div class="characteristic bad">
                <div class="characteristic-header">
                    <i class="fas fa-times"></i>
                    <h5>DON'T Do These</h5>
                </div>
                <ul>
                    <li><strong>Access HTTP context directly</strong> - That's the controller's job</li>
                    <li><strong>Write SQL queries</strong> - That's the repository's job</li>
                    <li><strong>Generate HTML/Views</strong> - That's the view's job</li>
                    <li><strong>Handle cookies/sessions</strong> - HTTP concerns belong to controllers</li>
                    <li><strong>Call external APIs directly</strong> - Create separate gateway services</li>
                    <li><strong>Hardcode configuration</strong> - Use dependency injection</li>
                    <li><strong>Mix responsibilities</strong> - One service, one responsibility</li>
                </ul>
            </div>
        </div>
    </div>

    <div class="interactive-example">
        <h2><i class="fas fa-play-circle"></i> Service Layer in Action: E-commerce Checkout</h2>
        
        <div class="checkout-flow">
            <div class="flow-step">
                <div class="step-header">
                    <div class="step-number">1</div>
                    <h5>User Submits Checkout Form</h5>
                </div>
                <div class="step-content">
                    <p><code>CheckoutController.PlaceOrder(checkoutData)</code></p>
                    <div class="step-note">Controller validates basic form data</div>
                </div>
            </div>
            
            <div class="flow-arrow">
                <i class="fas fa-arrow-down"></i>
            </div>
            
            <div class="flow-step service-step">
                <div class="step-header">
                    <div class="step-number">2</div>
                    <h5>OrderService.PlaceOrder()</h5>
                </div>
                <div class="step-content">
                    <div class="business-rules">
                        <h6><i class="fas fa-list-check"></i> Business Rules Applied:</h6>
                        <ul>
                            <li>✅ Check inventory for all items</li>
                            <li>✅ Calculate subtotal (sum of all items)</li>
                            <li>✅ Apply user-specific discounts</li>
                            <li>✅ Calculate tax based on location</li>
                            <li>✅ Calculate shipping costs</li>
                            <li>✅ Verify payment method is valid</li>
                            <li>✅ Check fraud risk score</li>
                        </ul>
                    </div>
                    <div class="coordination">
                        <h6><i class="fas fa-exchange-alt"></i> Coordinates With:</h6>
                        <div class="coordinated-services">
                            <span class="coord-service">ProductRepository</span>
                            <span class="coord-service">UserRepository</span>
                            <span class="coord-service">PaymentService</span>
                            <span class="coord-service">InventoryService</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="flow-arrow">
                <i class="fas fa-arrow-down"></i>
            </div>
            
            <div class="flow-step">
                <div class="step-header">
                    <div class="step-number">3</div>
                    <h5>Service Returns Result</h5>
                </div>
                <div class="step-content">
                    <div class="result-example">
<pre><code class="language-json">{
  "success": true,
  "orderId": 12345,
  "total": 149.99,
  "estimatedDelivery": "2024-01-25",
  "confirmationNumber": "ABC123XYZ",
  "items": [
    {
      "name": "Wireless Headphones",
      "price": 99.99,
      "discount": 10.00
    }
  ],
  "appliedDiscounts": ["LOYALTY10", "FIRSTORDER"],
  "messages": ["Free shipping applied!", "Loyalty discount: $10"]
}</code></pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="design-patterns">
        <h2><i class="fas fa-puzzle-piece"></i> Service Design Patterns</h2>
        
        <div class="patterns-grid">
            <div class="pattern-card">
                <div class="pattern-icon">
                    <i class="fas fa-tachometer-alt"></i>
                </div>
                <h4>Facade Service</h4>
                <p>Simplifies complex operations by providing a simple interface to multiple underlying services.</p>
<pre><code class="language-csharp">public class CheckoutFacadeService
{
    public OrderResult CompleteCheckout(CheckoutData data)
    {
        // Coordinates multiple services
        _cartService.ValidateCart(data.CartId);
        _paymentService.ProcessPayment(data.Payment);
        _shippingService.CalculateShipping(data.Address);
        _inventoryService.ReserveItems(data.Items);
        return _orderService.CreateOrder(data);
    }
}</code></pre>
            </div>
            
            <div class="pattern-card">
                <div class="pattern-icon">
                    <i class="fas fa-bolt"></i>
                </div>
                <h4>Strategy Pattern</h4>
                <p>Different business rules for different situations, easily swappable.</p>
<pre><code class="language-csharp">public interface IDiscountStrategy
{
    decimal CalculateDiscount(Order order);
}

public class LoyaltyDiscount : IDiscountStrategy { }
public class SeasonalDiscount : IDiscountStrategy { }
public class BulkDiscount : IDiscountStrategy { }

// Usage:
var discount = _discountStrategy.CalculateDiscount(order);</code></pre>
            </div>
            
            <div class="pattern-card">
                <div class="pattern-icon">
                    <i class="fas fa-bell"></i>
                </div>
                <h4>Observer Pattern</h4>
                <p>Notify other parts of the system when business events occur.</p>
<pre><code class="language-csharp">public class OrderService
{
    private List&lt;IOrderObserver&gt; _observers = new();
    
    public OrderResult PlaceOrder(Order order)
    {
        // Process order...
        
        // Notify observers
        foreach (var observer in _observers)
        {
            observer.OnOrderPlaced(order);
        }
    }
}

// Observers could be:
// - EmailNotificationService
// - InventoryUpdateService  
// - AnalyticsService
// - LoyaltyPointsService</code></pre>
            </div>
        </div>
    </div>

    <div class="quiz-section">
        <h3><i class="fas fa-brain"></i> Quick Check: Service Layer Knowledge</h3>
        <div class="quiz-question">
            <p><strong>Question:</strong> Which of these should be handled by the Service Layer?</p>
            
            <div class="quiz-options">
                <button class="quiz-option" data-correct="true">
                    <i class="fas fa-calculator"></i> Calculate discount based on user loyalty
                </button>
                <button class="quiz-option" data-correct="false">
                    <i class="fas fa-server"></i> Handle HTTP request/response formatting
                </button>
                <button class="quiz-option" data-correct="true">
                    <i class="fas fa-balance-scale"></i> Enforce minimum age requirement for registration
                </button>
                <button class="quiz-option" data-correct="false">
                    <i class="fas fa-database"></i> Write SQL queries to fetch data
                </button>
                <button class="quiz-option" data-correct="true">
                    <i class="fas fa-exchange-alt"></i> Coordinate between multiple repositories
                </button>
                <button class="quiz-option" data-correct="false">
                    <i class="fas fa-code"></i> Generate HTML for the user interface
                </button>
            </div>
            
            <div class="quiz-feedback">
                <p id="quiz-feedback-text"></p>
            </div>
        </div>
    </div>

    <div class="key-takeaways">
        <h3><i class="fas fa-graduation-cap"></i> Service Layer Summary</h3>
        <div class="takeaways-grid">
            <div class="takeaway">
                <i class="fas fa-brain"></i>
                <h5>The Business Brain</h5>
                <p>Services contain the intelligence that makes your application valuable. They know all the rules, calculations, and logic.</p>
            </div>
            
            <div class="takeaway">
                <i class="fas fa-orchestra"></i>
                <h5>The Orchestra Conductor</h5>
                <p>Services coordinate between different parts of your application, making sure everything works together harmoniously.</p>
            </div>
            
            <div class="takeaway">
                <i class="fas fa-shield-alt"></i>
                <h5>The Rule Enforcer</h5>
                <p>Services ensure that business rules are always followed, maintaining data integrity and consistency.</p>
            </div>
            
            <div class="takeaway">
                <i class="fas fa-code-branch"></i>
                <h5>The Reusable Core</h5>
                <p>Well-designed services can be reused by different controllers, APIs, or even different applications.</p>
            </div>
        </div>
    </div>

    <div class="navigation-buttons">
        <a href="@Url.Action("RepositoryLayer", "AdvancedWebApp")" class="btn btn-outline-primary ajax-link" data-path="/AdvancedWebApp/RepositoryLayer">← Back: Repository Layer</a>
        <a href="@Url.Action("Identity", "AdvancedWebApp")" class="btn btn-primary ajax-link" data-path="/AdvancedWebApp/Identity">Next: .NET Identity Introduction →</a>
    </div>
</div>

<style>
    .container { 
        max-width: 1000px; 
        padding: 20px; 
        background-color: var(--bs-body-bg); 
    }
    
    h1, h2, h3, h4, h5, h6 { 
        color: var(--bs-heading-color); 
        margin-bottom: 15px; 
    }
    
    h1 { 
        border-bottom: 2px solid var(--bs-success); 
        padding-bottom: 10px; 
    }
    
    .beginner-note {
        background-color: rgba(40, 167, 69, 0.1);
        border: 2px solid var(--bs-success);
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 30px;
        display: flex;
        gap: 15px;
        align-items: flex-start;
    }
    
    .beginner-note-icon {
        background-color: var(--bs-success);
        color: white;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        flex-shrink: 0;
    }
    
    .important-note {
        background-color: rgba(255, 193, 7, 0.2);
        border: 2px solid var(--bs-warning);
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 30px;
    }
    
    .intro-section {
        margin-bottom: 40px;
    }
    
    .service-responsibilities {
        margin-top: 20px;
    }
    
    .responsibility-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }
    
    .responsibility-item {
        text-align: center;
        padding: 20px;
        background-color: rgba(40, 167, 69, 0.1);
        border-radius: 8px;
        border: 1px solid rgba(40, 167, 69, 0.3);
    }
    
    .responsibility-icon {
        font-size: 2rem;
        color: var(--bs-success);
        margin-bottom: 10px;
    }
    
    .code-section {
        margin: 40px 0;
    }
    
    .example-tabs {
        margin-bottom: 20px;
    }
    
    .tab-buttons {
        display: flex;
        gap: 5px;
        margin-bottom: 20px;
        border-bottom: 2px solid var(--bs-border-color);
        padding-bottom: 10px;
        flex-wrap: wrap;
    }
    
    .tab-button {
        padding: 10px 20px;
        background-color: rgba(0, 0, 0, 0.1);
        border: none;
        border-radius: 4px;
        color: var(--bs-body-color);
        cursor: pointer;
        transition: all 0.3s;
    }
    
    .tab-button.active {
        background-color: var(--bs-success);
        color: white;
    }
    
    .tab-content {
        display: none;
        background-color: #1a1a1a;
        border-radius: 8px;
        overflow: hidden;
        margin-bottom: 20px;
    }
    
    .tab-content.active {
        display: block;
    }
    
    .code-explanation {
        padding: 15px;
        background-color: #2d2d2d;
        border-bottom: 1px solid #444;
    }
    
    .code-explanation h5 {
        display: flex;
        align-items: center;
        gap: 10px;
        color: var(--bs-success);
    }
    
    .service-characteristics {
        margin: 40px 0;
    }
    
    .characteristics-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-top: 20px;
    }
    
    @@media (max-width: 768px) {
        .characteristics-grid {
            grid-template-columns: 1fr;
        }
    }
    
    .characteristic {
        padding: 20px;
        border-radius: 8px;
    }
    
    .characteristic.good {
        background-color: rgba(40, 167, 69, 0.1);
        border: 1px solid var(--bs-success);
    }
    
    .characteristic.bad {
        background-color: rgba(220, 53, 69, 0.1);
        border: 1px solid var(--bs-danger);
    }
    
    .characteristic-header {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 15px;
    }
    
    .characteristic.good .characteristic-header i {
        color: var(--bs-success);
    }
    
    .characteristic.bad .characteristic-header i {
        color: var(--bs-danger);
    }
    
    .characteristic ul {
        margin: 0;
        padding-left: 20px;
    }
    
    .characteristic li {
        margin-bottom: 10px;
        padding-left: 5px;
    }
    
    .interactive-example {
        margin: 40px 0;
        padding: 25px;
        background-color: rgba(23, 162, 184, 0.1);
        border: 1px solid var(--bs-info);
        border-radius: 10px;
    }
    
    .checkout-flow {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }
    
    .flow-step {
        padding: 20px;
        background-color: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
        border-left: 4px solid var(--bs-info);
    }
    
    .flow-step.service-step {
        border-left: 4px solid var(--bs-success);
        background-color: rgba(40, 167, 69, 0.1);
    }
    
    .step-header {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 15px;
    }
    
    .step-number {
        background-color: var(--bs-info);
        color: white;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 1.2rem;
    }
    
    .service-step .step-number {
        background-color: var(--bs-success);
    }
    
    .step-note {
        font-style: italic;
        color: var(--bs-secondary);
        margin-top: 5px;
        font-size: 0.9rem;
    }
    
    .business-rules {
        margin-bottom: 20px;
    }
    
    .business-rules h6 {
        display: flex;
        align-items: center;
        gap: 10px;
        color: var(--bs-success);
        margin-bottom: 10px;
    }
    
    .business-rules ul {
        margin: 0;
        padding-left: 20px;
    }
    
    .business-rules li {
        margin-bottom: 5px;
        color: var(--bs-success);
    }
    
    .coordination h6 {
        display: flex;
        align-items: center;
        gap: 10px;
        color: var(--bs-info);
        margin-bottom: 10px;
    }
    
    .coordinated-services {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }
    
    .coord-service {
        background-color: var(--bs-info);
        color: white;
        padding: 5px 15px;
        border-radius: 20px;
        font-size: 0.9rem;
    }
    
    .result-example {
        background-color: #1a1a1a;
        border-radius: 8px;
        padding: 15px;
        overflow-x: auto;
    }
    
    .flow-arrow {
        text-align: center;
        color: var(--bs-info);
        font-size: 1.5rem;
    }
    
    .design-patterns {
        margin: 40px 0;
    }
    
    .patterns-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }
    
    .pattern-card {
        padding: 20px;
        background-color: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
        border: 1px solid var(--bs-secondary);
    }
    
    .pattern-icon {
        font-size: 2rem;
        color: var(--bs-warning);
        margin-bottom: 15px;
    }
    
    .quiz-section {
        margin: 40px 0;
        padding: 25px;
        background-color: rgba(255, 193, 7, 0.1);
        border: 1px solid var(--bs-warning);
        border-radius: 10px;
    }
    
    .quiz-question {
        margin-top: 20px;
    }
    
    .quiz-options {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 10px;
        margin: 20px 0;
    }
    
    .quiz-option {
        padding: 15px;
        background-color: rgba(0, 0, 0, 0.2);
        border: 2px solid var(--bs-secondary);
        border-radius: 8px;
        color: var(--bs-body-color);
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        gap: 10px;
        text-align: left;
    }
    
    .quiz-option:hover {
        background-color: rgba(0, 0, 0, 0.3);
        transform: translateY(-2px);
    }
    
    .quiz-option.correct {
        background-color: rgba(40, 167, 69, 0.3);
        border-color: var(--bs-success);
    }
    
    .quiz-option.incorrect {
        background-color: rgba(220, 53, 69, 0.3);
        border-color: var(--bs-danger);
    }
    
    .quiz-option.selected {
        border-width: 3px;
    }
    
    .quiz-feedback {
        padding: 15px;
        background-color: rgba(0, 0, 0, 0.1);
        border-radius: 8px;
        display: none;
    }
    
    .quiz-feedback.show {
        display: block;
        animation: fadeIn 0.5s;
    }
    
    .key-takeaways {
        margin: 40px 0;
        padding: 25px;
        background-color: rgba(111, 66, 193, 0.1);
        border: 1px solid var(--bs-indigo);
        border-radius: 10px;
    }
    
    .takeaways-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }
    
    .takeaway {
        text-align: center;
        padding: 20px;
        background-color: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
    }
    
    .takeaway i {
        font-size: 2rem;
        color: var(--bs-indigo);
        margin-bottom: 15px;
    }
    
    .navigation-buttons {
        display: flex;
        justify-content: space-between;
        margin-top: 40px;
        padding-top: 20px;
        border-top: 2px solid var(--bs-border-color);
    }
    
    .btn {
        padding: 12px 25px;
        border-radius: 6px;
        font-weight: 500;
        transition: all 0.3s;
    }
    
    .btn:hover {
        transform: translateY(-2px);
    }
    
    @@media (max-width: 768px) {
        .beginner-note {
            flex-direction: column;
            text-align: center;
        }
        
        .checkout-flow {
            gap: 10px;
        }
        
        .flow-step {
            padding: 15px;
        }
        
        .coordinated-services {
            justify-content: center;
        }
        
        .navigation-buttons {
            flex-direction: column;
            gap: 10px;
        }
        
        .navigation-buttons .btn {
            width: 100%;
            text-align: center;
        }
    }
</style>

<script>
$(document).ready(function() {
    // Initialize syntax highlighting
    if (typeof hljs !== 'undefined') {
        hljs.highlightAll();
    }
    
    // Tab functionality
    $('.tab-button').click(function() {
        const tabId = $(this).data('tab');
        
        // Update active tab
        $('.tab-button').removeClass('active');
        $(this).addClass('active');
        
        // Show corresponding content
        $('.tab-content').removeClass('active');
        $(`#${tabId}-tab`).addClass('active');
    });
    
    // Quiz functionality
    $('.quiz-option').click(function() {
        const $this = $(this);
        const isCorrect = $this.data('correct') === true;
        
        // Reset all options
        $('.quiz-option').removeClass('correct incorrect selected');
        
        // Mark this option as selected
        $this.addClass('selected');
        
        // Mark correct/incorrect
        $this.addClass(isCorrect ? 'correct' : 'incorrect');
        
        // Show feedback based on selection
        let feedbackText;
        if (isCorrect) {
            feedbackText = '✅ Correct! Business logic like calculations, rules enforcement, and coordination belong in the Service Layer. HTTP handling, SQL queries, and UI generation belong elsewhere.';
        } else {
            feedbackText = '❌ Actually, HTTP concerns, database queries, and UI generation should NOT be in the Service Layer. Services should focus purely on business logic and coordination.';
        }
        
        $('#quiz-feedback-text').text(feedbackText);
        $('.quiz-feedback').addClass('show');
    });
    
    // Animate flow steps
    const flowSteps = $('.flow-step');
    flowSteps.each(function(index) {
        $(this).css({
            'opacity': '0',
            'transform': 'translateY(20px)',
            'transition': 'all 0.5s ease ' + (index * 0.2) + 's'
        });
    });
    
    setTimeout(() => {
        flowSteps.each(function() {
            $(this).css({
                'opacity': '1',
                'transform': 'translateY(0)'
            });
        });
    }, 300);

    $('.navigation-buttons a').addClass('ajax-link');
});
</script>