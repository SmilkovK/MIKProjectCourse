@{
    ViewData["Title"] = "For циклиси";
}

<div class="container" data-topic="loops">
    <h1 class="mb-4">For циклуси: Повторување на акции</h1>

    <p>Циклусите се една од најмоќните алатки во програмирањето, кои ти овозможуваат да <strong>повторуваш акции</strong> без да го препишуваш истиот код многу пати. <strong>For циклусот</strong> е совршен за ситуации кога точно знаеш колку пати треба да се повтори акцијата.</p>

    <h2>Структура на For циклус</h2>
    <p><strong>For циклус</strong> е дефиниран со три контролни изрази во заградите, одделени со точка-запирка (<code>;</code>):</p>

    <div class="code-container">
        <div class="code-header">Синтакса на For циклус</div>
        <div class="code-content">
<pre>
for (<span style="color: green;">иницијализација</span>; <span style="color: red;">услов</span>; <span style="color: blue;">зголемување</span>) {
    // код што се повторува (телото на циклусот)
}
</pre>
        </div>
    </div>

    <ul>
        <li>1. <strong style="color: green;">Иницијализација</strong>: Се извршува <strong>еднаш</strong> на самиот почеток. Ја поставува бројачката променлива (пр. <code>int i = 0</code>).</li>
        <li>2. <strong style="color: red;">Услов</strong>: Се проверува <strong>пред секое повторување</strong>. Ако е <code>true</code>, телото на циклусот се извршува. Ако е <code>false</code>, циклусот запира.</li>
        <li>3. <strong style="color: blue;">Зголемување/Намалување</strong>: Се извршува <strong>по секое повторување</strong>. Ја ажурира бројачката променлива (пр. <code>i++</code> за зголемување или <code>i--</code> за намалување).</li>
    </ul>

    <h2>Пример 1: Броење нагоре (зголемување)</h2>
    <p>Ова е најчестата употреба: броење од помал број кон поголем број.</p>

    <div class="code-container">
        <div class="form-check form-switch mb-2">
            <input class="form-check-input" type="checkbox" id="example1Toggle" onchange="window.convertCode('example1')">
            <label class="form-check-label" for="example1Toggle">Претвори во C#</label>
        </div>
        <div class="code-content">
<pre class="codeBlock" id="example1Code">
for (int i = 1; i <= 5; i++) {
    cout << "Плесок " << i << endl;
}
</pre>
        </div>
        <div class="result-box" id="example1Result">
            <strong>Резултат:</strong> Плесок 1<br>Плесок 2<br>Плесок 3<br>Плесок 4<br>Плесок 5<br>
            <em>Објаснување:</em> Циклусот започнува од 1 и се извршува додека <code>i</code> е помало или еднакво на 5. Секоја итерација печати „Плесок“ и тековниот број.
        </div>
    </div>

    <h2>Пример 2: Броење наназад (намалување)</h2>
    <p>Можеш да користиш циклуси и за броење наназад, на пример за одбројување.</p>

    <div class="code-container">
        <div class="form-check form-switch mb-2">
            <input class="form-check-input" type="checkbox" id="example2Toggle" onchange="window.convertCode('example2')">
            <label class="form-check-label" for="example2Toggle">Претвори во C#</label>
        </div>
        <div class="code-content">
<pre class="codeBlock" id="example2Code">
for (int i = 10; i >= 1; i--) {
    cout << i << " ";
}
</pre>
        </div>
        <div class="result-box" id="example2Result">
            <strong>Резултат:</strong> 10 9 8 7 6 5 4 3 2 1<br>
            <em>Објаснување:</em> Циклусот започнува од 10. Условот е <code>i >= 1</code>, а ажурирањето е <code>i--</code>, што го намалува <code>i</code> за 1 секој пат.
        </div>
    </div>

    <h2>Пример 3: Обработка на податоци (пресметка на збир)</h2>
    <p>Циклусите често се користат за обработка на податоци, како што е пресметка на вкупна сума. Користиме посебна променлива (<code>sum</code>) надвор од циклусот за да го чуваме тековниот збир.</p>

    <div class="code-container">
        <div class="form-check form-switch mb-2">
            <input class="form-check-input" type="checkbox" id="example3Toggle" onchange="window.convertCode('example3')">
            <label class="form-check-label" for="example3Toggle">Претвори во C#</label>
        </div>
        <div class="code-content">
<pre class="codeBlock" id="example3Code">
int sum = 0;
for (int i = 1; i <= 5; i++) {
    sum += i; // Скратено за: sum = sum + i;
}
cout << "Збир = " << sum;
</pre>
        </div>
        <div class="result-box" id="example3Result">
            <strong>Резултат:</strong> Збир = 15<br>
            <em>Објаснување:</em> Циклусот го додава секој број од 1 до 5 во променливата <code>sum</code>. Вкупниот збир е 15.
        </div>
    </div>

    <h2>Интерактивен водич: Следење на кодот</h2>
    <p>Погледни како кодот (Пример 3) се извршува чекор по чекор. Делот <strong>Активен код</strong> покажува која линија моментално се извршува, а <strong>Состојба на променливи</strong> ги следи промените.</p>

    <h2>Пример 4: Поминување низ текст (стрингови)</h2>
    <p>Можеш да ја користиш бројачката променлива на циклусот за пристап до поединечни карактери од текст. Започнуваме од 0 бидејќи во програмирањето најчесто броиме од нула.</p>

    <h2>Визуелен дијаграм</h2>
    <p>Овој дијаграм го прикажува текот на извршување на <strong>For циклус</strong> од почеток до крај.</p>

    <h2>Резиме</h2>
    <ul>
        <li><strong>For циклус</strong> е најдобар кога го знаеш бројот на повторувања.</li>
        <li>Трите делови го контролираат <strong>почетокот</strong> (иницијализација), <strong>крајот</strong> (услов) и <strong>чекорот</strong> (зголемување/намалување).</li>
        <li>Циклусите се неопходни за задачи како броење, пресметка на збир и итерирање низ структури на податоци како стрингови.</li>
    </ul>

    <div class="navigation-buttons">
        <a href="@Url.Action("IfElse", "SP")" class="btn btn-outline-primary ajax-link">← If Else</a>
        <a href="@Url.Action("Arrays", "SP")" class="btn btn-primary ajax-link">Низи →</a>
    </div>
</div>


<style>
    .container {
        max-width: 800px;
        padding: 20px;
        background-color: var(--bs-body-bg);
    }

    h1, h2 {
        color: var(--bs-heading-color);
        margin-bottom: 15px;
    }

    p, li, code {
        color: var(--bs-body-color);
        line-height: 1.6;
    }

    .code-container {
        margin: 25px 0;
        border: 1px solid var(--bs-border-color);
        border-radius: 5px;
        overflow: hidden;
        background-color: var(--code-bg);
    }

    .code-header {
        background-color: var(--code-header-bg);
        padding: 10px 15px;
        border-bottom: 1px solid var(--bs-border-color);
        font-family: 'SFMono-Regular', Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        font-size: 0.9rem;
        color: var(--bs-body-color);
    }

    .code-content {
        padding: 15px;
        overflow-x: auto;
    }

    pre {
        margin: 0;
        white-space: pre-wrap;
        background-color: transparent;
        font-family: 'SFMono-Regular', Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    .result-box {
        padding: 10px 15px;
        background-color: rgba(0, 123, 255, 0.1);
        border-top: 1px solid var(--bs-border-color);
        font-size: 0.95rem;
    }

    .fade {
        opacity: 0;
        transition: opacity 0.25s ease;
    }

    .navigation-buttons {
        display: flex;
        justify-content: space-between;
        margin-top: 30px;
    }

    .btn {
        padding: 8px 20px;
        border-radius: 4px;
        font-weight: 500;
        text-decoration: none;
    }

    .btn-primary {
        background-color: var(--bs-primary);
        border-color: var(--bs-primary);
        color: #fff;
    }

    .btn-outline-primary {
        color: var(--bs-primary);
        border-color: var(--bs-primary);
        background-color: transparent;
    }
</style>

<script>
// Make all functions and data available globally
window.fullCodeLines = [
    'int sum = 0;',
    'for (int i = 1; i <= 5; i++) {',
    '    sum += i; // ⬅ Run Code Block',
    '}',
    'cout << "Sum = " << sum;'
];

window.traceSteps = [
    { line: 0, vars: 'i = ?, sum = 0', exp: 'Initializes the variable <code>sum</code> to 0.' },
    { line: 1, vars: 'i = 1, sum = 0', exp: 'Initializes loop: <code>i = 1</code>. Checks condition: (1 <= 5) is TRUE.' },
    { line: 2, vars: 'i = 1, sum = 1', exp: 'Iteration 1 (i=1): Body runs. <code>sum = 0 + 1</code>.' },
    { line: 1, vars: 'i = 2, sum = 1', exp: 'End of loop body. Runs increment: <code>i++</code> (i is now 2). Checks condition: (2 <= 5) is TRUE.' },
    { line: 2, vars: 'i = 2, sum = 3', exp: 'Iteration 2 (i=2): Body runs. <code>sum = 1 + 2</code>.' },
    { line: 1, vars: 'i = 3, sum = 3', exp: 'End of loop body. Runs increment: <code>i++</code> (i is now 3). Checks condition: (3 <= 5) is TRUE.' },
    { line: 2, vars: 'i = 3, sum = 6', exp: 'Iteration 3 (i=3): Body runs. <code>sum = 3 + 3</code>.' },
    { line: 1, vars: 'i = 4, sum = 6', exp: 'End of loop body. Runs increment: <code>i++</code> (i is now 4). Checks condition: (4 <= 5) is TRUE.' },
    { line: 2, vars: 'i = 4, sum = 10', exp: 'Iteration 4 (i=4): Body runs. <code>sum = 6 + 4</code>.' },
    { line: 1, vars: 'i = 5, sum = 10', exp: 'End of loop body. Runs increment: <code>i++</code> (i is now 5). Checks condition: (5 <= 5) is TRUE.' },
    { line: 2, vars: 'i = 5, sum = 15', exp: 'Iteration 5 (i=5): Body runs. <code>sum = 10 + 5</code>.' },
    { line: 1, vars: 'i = 6, sum = 15', exp: 'End of loop body. Runs increment: <code>i++</code> (i is now 6). Checks condition: (6 <= 5) is FALSE. Loop ends.' },
    { line: 4, vars: 'i = 6, sum = 15', exp: 'Code proceeds after the loop, printing the final result.' }
];

// Initialize global state
window.currentTraceStep = 0;

window.cppSnippets = {
    example1: `for (int i = 1; i <= 5; i++) {
    cout << "Clap " << i << endl;
}`,
    example2: `for (int i = 10; i >= 1; i--) {
    cout << i << " ";
}`,
    example3: `int sum = 0;
for (int i = 1; i <= 5; i++) {
            sum += i; // Скратеница за: сума = сума + i;
}
cout << "Sum = " << sum;`,
    example4: `string word = "CODE";
for (int i = 0; i < word.length(); i++) {
    cout << word[i] << endl;
}`
};

window.csharpSnippets = {
    example1: `for (int i = 1; i <= 5; i++)
{
    Console.WriteLine("Clap " + i);
}`,
    example2: `for (int i = 10; i >= 1; i--)
{
    Console.Write(i + " ");
}`,
    example3: `int sum = 0;
for (int i = 1; i <= 5; i++)
{
    sum += i;
}
Console.WriteLine("Sum = " + sum);`,
    example4: `string word = "CODE";
for (int i = 0; i < word.Length; i++)
{
    Console.WriteLine(word[i]);
}`
};

// Function to convert code between C++ and C#
window.convertCode = function(id) {
    console.log("Converting code for:", id);
    const toggle = document.getElementById(id + "Toggle");
    const isCSharp = toggle ? toggle.checked : false;
    const codeBlock = document.getElementById(id + "Code");
    
    if (!codeBlock) {
        console.error("Code block not found for:", id);
        return;
    }
    
    codeBlock.classList.add("fade");
    setTimeout(() => {
        const newCode = isCSharp ? window.csharpSnippets[id] : window.cppSnippets[id];
        if (newCode) {
            codeBlock.textContent = newCode;
        }
        codeBlock.classList.remove("fade");
    }, 250);
};

// Function to update walkthrough
window.updateWalkthrough = function(step) {
    const walkthroughCodeBase = document.getElementById('walkthroughCodeBase');
    const walkthroughVariables = document.getElementById('walkthroughVariables');
    const walkthroughExplanation = document.getElementById('walkthroughExplanation');
    
    if (!walkthroughCodeBase || !walkthroughVariables || !walkthroughExplanation) return;
    
    const data = window.traceSteps[step];
    let codeContent = '';
    const activeLineIndex = data.line;
    
    window.fullCodeLines.forEach((line, index) => {
        if (index === activeLineIndex) {
            codeContent += `<span style="background-color: yellow; color: black;">${line.replace('// ⬅ Run Code Block', '⬅ ACTIVE')}</span>\n`;
        } else if (line.includes('// ⬅ Run Code Block')) {
            codeContent += `// ${line.replace('// ⬅ Run Code Block', '').trim()}\n`;
        } else if (index === 1 && activeLineIndex !== 1 && activeLineIndex !== 2) {
            codeContent += `// ${line.trim()}\n`;
        } else if (activeLineIndex >= 1 && activeLineIndex <= 3 && index > 3) {
            codeContent += `// ${line.trim()}\n`;
        } else if (index !== activeLineIndex) {
            codeContent += `${line}\n`;
        }
    });
    
    walkthroughCodeBase.innerHTML = codeContent;
    walkthroughVariables.textContent = data.vars;
    walkthroughExplanation.innerHTML = `<em>Explanation:</em> ${data.exp}`;
    
    if (step === window.traceSteps.length - 1) {
        walkthroughExplanation.innerHTML += '<br><strong>Trace finished! Final output is "Sum = 15".</strong>';
        const nextStepBtn = document.getElementById('nextStepBtn');
        if (nextStepBtn) {
            nextStepBtn.disabled = true;
        }
    }
};

// Create global handler for walkthrough button
window.nextStepHandler = function() {
    if (window.currentTraceStep < window.traceSteps.length) {
        if (typeof window.updateWalkthrough === 'function') {
            window.updateWalkthrough(window.currentTraceStep);
            window.currentTraceStep++;
        }
    }
};

// Initialize all code examples on page load
function initializeCodeExamples() {
    console.log("Initializing For Loops page code examples");
    for (let i = 1; i <= 4; i++) {
        const toggle = document.getElementById(`example${i}Toggle`);
        const codeBlock = document.getElementById(`example${i}Code`);
        if (toggle && codeBlock) {
            const isCSharp = toggle.checked;
            const newCode = isCSharp ? window.csharpSnippets[`example${i}`] : window.cppSnippets[`example${i}`];
            if (newCode) {
                codeBlock.textContent = newCode;
            }
        }
    }
}

function initializeWalkthrough() {
    console.log("Initializing For Loops walkthrough");
    const nextStepBtn = document.getElementById('nextStepBtn');
    if (nextStepBtn) {
        window.currentTraceStep = 0;
        
        if (typeof window.updateWalkthrough === 'function') {
            window.updateWalkthrough(0);
            window.currentTraceStep = 1;
        }
        
        nextStepBtn.disabled = false;
    }
}

document.addEventListener('DOMContentLoaded', function() {
    console.log("DOM loaded, initializing For Loops page");
    initializeCodeExamples();
    initializeWalkthrough();
});

if (document.readyState === 'complete' || document.readyState === 'interactive') {
    setTimeout(function() {
        console.log("Document ready, initializing For Loops page");
        initializeCodeExamples();
        initializeWalkthrough();
    }, 100);
}

window.initializeForLoopsPage = function() {
    console.log("Initializing For Loops page via global function");
    initializeCodeExamples();
    initializeWalkthrough();
};
</script>