@{
    ViewData["Title"] = "OOP - Енкапсулација";
}

<body data-topic="encapsulation">
    <div class="container">
        <h1 class="mb-4 text-center">Енкапсулација: Заштита на вашите податоци</h1>

        <p><strong>Енкапсулацијата</strong> е како да имате <strong>катанец на дневник</strong>. Вие контролирате кој може да чита, кој може да запишува и кој воопшто нема пристап. Во програмирањето, енкапсулацијата го контролира пристапот до податоците и методите на класата.</p>

        <p>Енкапсулација гледате секојдневно:</p>
        <ul>
            <li>Вашата <strong>банкарска состојба</strong> е приватна – не ја менувате директно, туку преку уплати и исплати</li>
            <li><strong>Моторот на автомобилот</strong> е скриен – користите педали и волан</li>
            <li>Вашата <strong>лозинка за социјални мрежи</strong> е приватна – пристапувате преку логирање</li>
            <li><strong>Лекови</strong> имаат заштитно капаче – не секој може да ги отвори</li>
        </ul>

        <div class="note-box">
            <strong>Поврзаност:</strong> Во лекцијата за
            <a href="@Url.Action("Classes", "OOP")" class="ajax-link"><strong>Класи</strong></a>
            користевме <code>public</code>. Сега ќе научите ЗОШТО понекогаш користиме <code>private</code> и <code>protected</code>.
        </div>

        <h2 class="text-center">Што е енкапсулација?</h2>
        <p>Енкапсулацијата има три нивоа на пристап:</p>

        <div class="code-container">
            <div class="code-header">Модификатори на пристап</div>
            <div class="code-content">
<pre>
НИВО НА ПРИСТАП   КОЈ МОЖЕ ДА ПРИСТАПИ           ПРИМЕР ОД РЕАЛНИОТ СВЕТ
────────────────────────────────────────────────────────────────────────
public            СИТЕ                          Јавен парк
private           САМО ОВАА КЛАСА                Личен дневник
protected         КЛАСА + НАСЛЕДНИЦИ             Семеен албум

public    = Отворена врата
private   = Заклучена врата
protected = Врата со семеен клуч
</pre>
            </div>
        </div>

        <h2 class="text-center">1. Public: Отворена врата</h2>
        <div class="code-container">
            
            <div class="code-content">

                <p><code>public</code> значи дека секој може да пристапи од било каде.</p>

<pre class="language-csharp">
// ЈАВНА БАНКАРСКА СМЕТКА (ОПАСНО!)
public class BankAccount
{
    public decimal Balance;
    public string Owner;
}
</pre>

                <p><strong>Проблем:</strong> Секој може директно да ја смени состојбата – дури и на негативна вредност.</p>

            </div>
        </div>

        <h2 class="text-center">2. Private: Заклучена врата</h2>
        <div class="code-container">
            <div class="code-content">

                <p><code>private</code> значи дека само самата класа има пристап.</p>

<pre class="language-csharp">
// БЕЗБЕДНА БАНКАРСКА СМЕТКА
public class BankAccount
{
    private decimal balance;

    public void Deposit(decimal amount)
    {
        if (amount > 0)
            balance += amount;
    }

    public decimal GetBalance()
    {
        return balance;
    }
}
</pre>

                <p>Податоците се заштитени и се менуваат само преку контролирани методи.</p>

            </div>
        </div>

        <h2 class="text-center">3. Protected: Семејна врата</h2>
        <div class="code-container">
            <div class="code-content">

                <p><code>protected</code> овозможува пристап само на класата и нејзините наследници.</p>

<pre class="language-csharp">
public class Animal
{
    protected int Age;
}

public class Dog : Animal
{
    public void Grow()
    {
        Age++;
    }
}
</pre>

            </div>
        </div>
        <h2 class="text-center">Чести грешки</h2>
        <div class="code-container">

            <div class="code-content">

<pre>
<span style="color:red;">// ГРЕШКА: Сѐ е public</span>
public string Password;

<span style="color:lightgreen;">// РЕШЕНИЕ: private + контролирани методи</span>
private string password;
</pre>

            </div>
        </div>

        <h2 class="text-center">Getter / Setter (Својства)</h2>
        <div class="code-container">
            <div class="code-content">

<pre class="language-csharp">
public class Person
{
    private int age;

    public int Age
    {
        get { return age; }
        set
        {
            if (value >= 0 && value <= 150)
                age = value;
        }
    }
}
</pre>

            </div>
        </div>

        <h2 class="text-center">Кога што да користиш?</h2>
        <div class="code-container">
            <div class="code-content">

<pre>
Користи public:
- Јавни информации t
- Методи што корисникот треба да ги користи

Користи private:
- Лозинки
- Внатрешна логика
- Чувствителни податоци

Користи protected:
- Наследување
- Основни класи
</pre>

            </div>
        </div>


        <h2 class="text-center">Резиме</h2>
        <ul>
            <li>Енкапсулацијата го контролира пристапот до податоци</li>
            <li><code>public</code> – за јавен интерфејс</li>
            <li><code>private</code> – за заштита</li>
            <li><code>protected</code> – за наследници</li>
            <li>Го спречува хаосот и грешките во кодот</li>
        </ul>

        <div class="navigation-buttons">
            <a href="@Url.Action("Inheritance", "OOP")" class="btn btn-outline-primary ajax-link">← Наследување</a>
            <a href="@Url.Action("Polymorphism", "OOP")" class="btn btn-primary ajax-link">Полиморфизам →</a>
        </div>
    </div>


<style>
    .container {
        max-width: 800px;
        padding: 20px;
        background-color: var(--bs-body-bg);
    }

    h1, h2, h3 {
        color: var(--bs-heading-color);
        margin-bottom: 15px;
    }

    h1 {
        border-bottom: 2px solid var(--bs-primary);
        padding-bottom: 10px;
    }

    p, li, code {
        color: var(--bs-body-color);
        line-height: 1.6;
    }

    .note-box {
        background-color: rgba(255, 193, 7, 0.1);
        border: 1px solid var(--bs-warning);
        border-radius: 5px;
        padding: 15px;
        margin: 20px 0;
    }

    .note-box a {
        color: var(--bs-warning);
        text-decoration: underline;
    }

    .code-container {
        margin: 25px 0;
        border: 1px solid var(--bs-border-color);
        border-radius: 5px;
        overflow: hidden;
        background-color: var(--code-bg);
    }

    .code-header {
        background-color: var(--code-header-bg);
        padding: 10px 15px;
        border-bottom: 1px solid var(--bs-border-color);
        font-family: 'SFMono-Regular', Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        font-size: 0.9rem;
        color: var(--bs-body-color);
    }

    .code-content {
        padding: 15px;
        overflow-x: auto;
    }

    pre {
        margin: 0;
        white-space: pre-wrap;
        background-color: transparent;
        font-family: 'SFMono-Regular', Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    .result-box {
        padding: 10px 15px;
        background-color: rgba(0, 123, 255, 0.1);
        border-top: 1px solid var(--bs-border-color);
        font-size: 0.95rem;
    }

    .navigation-buttons {
        display: flex;
        justify-content: space-between;
        margin-top: 30px;
    }

    .btn {
        padding: 8px 20px;
        border-radius: 4px;
        font-weight: 500;
        text-decoration: none;
    }

    .btn-primary {
        background-color: var(--bs-primary);
        border-color: var(--bs-primary);
        color: #fff;
    }

    .btn-outline-primary {
        color: var(--bs-primary);
        border-color: var(--bs-primary);
        background-color: transparent;
    }

    .btn-outline-secondary {
        color: var(--bs-secondary);
        border-color: var(--bs-secondary);
        background-color: transparent;
    }

    .btn-sm {
        padding: 5px 10px;
        font-size: 0.875rem;
    }
</style>

<script>
    // Create a namespace for OOP Encapsulation page
    window.oopEncapsulation = {
        // Interactive walkthrough for encapsulation
        encapsulationSteps: [
            {
                code: `public class Student
{
    public string Name;           // Public - anyone can access
    private int grade;           // Private - only class can access
    
    public void SetGrade(int newGrade)
    {
        if (newGrade >= 0 && newGrade <= 100)
            grade = newGrade;    // Can access private here
    }
    
    public string GetGradeLetter()
    {
        if (grade >= 90) return "A";
        if (grade >= 80) return "B";
        return "C or below";
    }
}

// Student student = new Student();
// student.Name = "Alex";
// student.SetGrade(85);
// Console.WriteLine(student.GetGradeLetter());
// student.grade = 200;  // What happens?`,
                vars: `Student class defined:
- Name: public (open door)
- grade: private (locked door)
- SetGrade(): public method
- GetGradeLetter(): public method

No student object created yet.`,
                exp: "We define a Student class with mixed access: Name is public (anyone can see/set), grade is private (hidden), and we provide public methods to interact with the private grade."
            },
            {
                code: `public class Student
{
    public string Name;           // Public - anyone can access
    private int grade;           // Private - only class can access
    
    public void SetGrade(int newGrade)
    {
        if (newGrade >= 0 && newGrade <= 100)
            grade = newGrade;    // Can access private here
    }
    
    public string GetGradeLetter()
    {
        if (grade >= 90) return "A";
        if (grade >= 80) return "B";
        return "C or below";
    }
}

Student student = new Student();
// student.Name = "Alex";
// student.SetGrade(85);
// Console.WriteLine(student.GetGradeLetter());
// student.grade = 200;  // What happens?`,
                vars: `Student object created:
- Name: (empty, can be set publicly)
- grade: 0 (default, PRIVATE - hidden)
- Can call: SetGrade(), GetGradeLetter()

The private grade is safely hidden inside the object.`,
                exp: "We create a Student object. Notice that even though we can't see or access the grade directly (it's private), it exists inside the object with default value 0."
            },
            {
                code: `public class Student
{
    public string Name;           // Public - anyone can access
    private int grade;           // Private - only class can access
    
    public void SetGrade(int newGrade)
    {
        if (newGrade >= 0 && newGrade <= 100)
            grade = newGrade;    // Can access private here
    }
    
    public string GetGradeLetter()
    {
        if (grade >= 90) return "A";
        if (grade >= 80) return "B";
        return "C or below";
    }
}

Student student = new Student();
student.Name = "Alex";           // Public: works
student.SetGrade(85);            // Public method works
// Console.WriteLine(student.GetGradeLetter());
// student.grade = 200;  // What happens?`,
                vars: `Student object now:
- Name: "Alex" (set publicly)
- grade: 85 (set via SetGrade() method)
- SetGrade() validated: 85 is between 0-100

The private grade was modified SAFELY through our controlled method.`,
                exp: "We set the public Name directly (anyone can do this). We set the private grade through SetGrade() method, which validates the input (85 is valid). This is safe encapsulation!"
            },
            {
                code: `public class Student
{
    public string Name;           // Public - anyone can access
    private int grade;           // Private - only class can access
    
    public void SetGrade(int newGrade)
    {
        if (newGrade >= 0 && newGrade <= 100)
            grade = newGrade;    // Can access private here
    }
    
    public string GetGradeLetter()
    {
        if (grade >= 90) return "A";
        if (grade >= 80) return "B";
        return "C or below";
    }
}

Student student = new Student();
student.Name = "Alex";
student.SetGrade(85);
Console.WriteLine(student.GetGradeLetter());  // Gets grade letter
// student.grade = 200;  // What happens?`,
                vars: `Operations performed:
1. Set public Name to "Alex"
2. Set private grade to 85 via SetGrade()
3. GetGradeLetter() checks private grade (85)
   → 85 >= 80 → Returns "B"

Output: "B"

The private grade is used but never exposed directly.`,
                exp: "GetGradeLetter() reads the private grade (85) and returns 'B'. Notice: We never see the actual grade number 85 from outside - we only see the letter 'B'. The grade is encapsulated (hidden) but we can get useful information about it."
            },
            {
                code: `public class Student
{
    public string Name;           // Public - anyone can access
    private int grade;           // Private - only class can access
    
    public void SetGrade(int newGrade)
    {
        if (newGrade >= 0 && newGrade <= 100)
            grade = newGrade;    // Can access private here
    }
    
    public string GetGradeLetter()
    {
        if (grade >= 90) return "A";
        if (grade >= 80) return "B";
        return "C or below";
    }
}

Student student = new Student();
student.Name = "Alex";
student.SetGrade(85);
Console.WriteLine(student.GetGradeLetter());
student.grade = 200;  // What happens?  TRYING TO ACCESS PRIVATE!`,
                vars: `Trying to access private field:
- student.grade = 200; ← This line

What happens? COMPILER ERROR!

Error message: 
'Student.grade' is inaccessible due to its protection level

The private field is PROTECTED by encapsulation.`,
                exp: "This line causes a COMPILE ERROR! The compiler stops us because 'grade' is private. This is encapsulation in action - preventing bad code from accessing data it shouldn't. Without encapsulation, someone could set grade to 200 (impossible!) or -50 (nonsense!)."
            }
        ],

        simpleExamples: {
            example1: `// Example: Public Bank Account (DANGEROUS!)
public class BankAccount
{
    // WARNING: Public properties = Anyone can change!
    public decimal Balance;
    public string Owner;
    
    public void ShowBalance()
    {
        Console.WriteLine(Owner + "'s balance: $" + Balance);
    }
}

// Using the account
BankAccount account = new BankAccount();
account.Owner = "Alice";
account.Balance = 1000.00m;`,
            example2: `// Example: Private Bank Account (SAFE!)
public class BankAccount
{
    // SAFE: Private fields - only this class can access
    private decimal balance;
    private string owner;
    
    // Public methods to CONTROL access
    public string Owner
    {
        get { return owner; }
        set 
        { 
            if (!string.IsNullOrEmpty(value))
                owner = value;
        }
    }
    
    public void Deposit(decimal amount)
    {
        if (amount > 0)
        {
            balance += amount;
            Console.WriteLine("Deposited: $" + amount);
        }
    }
    
    public bool Withdraw(decimal amount)
    {
        if (amount > 0 && amount <= balance)
        {
            balance -= amount;
            Console.WriteLine("Withdrew: $" + amount);
            return true;
        }
        return false;
    }
    
    public decimal GetBalance()
    {
        return balance;
    }
}`,
            example3: `public class SocialMediaAccount
{
    // Public info
    public string Username;
    public string DisplayName;
    public int PostCount;
    
    // Private info
    private string password;
    private string email;
    
    // Constructor
    public SocialMediaAccount(string user, string pass, string mail)
    {
        Username = user;
        password = pass;
        email = mail;
        PostCount = 0;
    }
    
    // Public methods for interaction
    public bool Login(string enteredPassword)
    {
        return enteredPassword == password;
    }
    
    public void ChangePassword(string oldPass, string newPass)
    {
        if (oldPass == password && newPass.Length >= 8)
        {
            password = newPass;
        }
    }
    
    public void MakePost(string content)
    {
        PostCount++;
        Console.WriteLine(Username + " posted: " + content);
    }
}`
        },

        completeExamples: {
            example1: `// Example: Public Bank Account (DANGEROUS!)
public class BankAccount
{
    // WARNING: Public properties = Anyone can change!
    public decimal Balance;
    public string Owner;
    
    public void ShowBalance()
    {
        Console.WriteLine(Owner + "'s balance: $" + Balance);
    }
}

// Using the account
BankAccount account = new BankAccount();
account.Owner = "Alice";
account.Balance = 1000.00m;

account.ShowBalance();  // Alice's balance: $1000

// PROBLEM: Anyone can change the balance directly!
account.Balance = -5000.00m;  // Setting negative balance? That's bad!
account.Balance = 9999999.99m;  // Creating free money? That's worse!

account.ShowBalance();  // Now shows crazy amounts`,
            example2: `// Example: Private Bank Account (SAFE!)
public class BankAccount
{
    // SAFE: Private fields - only this class can access
    private decimal balance;
    private string owner;
    
    // Public methods to CONTROL access (getters/setters)
    public string Owner
    {
        get { return owner; }
        set 
        { 
            if (!string.IsNullOrEmpty(value))
                owner = value;
        }
    }
    
    // Public method to deposit (with validation)
    public void Deposit(decimal amount)
    {
        if (amount > 0)
        {
            balance += amount;
            Console.WriteLine("Deposited: $" + amount);
        }
        else
        {
            Console.WriteLine("Deposit amount must be positive!");
        }
    }
    
    // Public method to withdraw (with validation)
    public bool Withdraw(decimal amount)
    {
        if (amount > 0 && amount <= balance)
        {
            balance -= amount;
            Console.WriteLine("Withdrew: $" + amount);
            return true;
        }
        else
        {
            Console.WriteLine("Withdrawal failed!");
            return false;
        }
    }
    
    // Public method to check balance
    public decimal GetBalance()
    {
        return balance;
    }
}

// Using the safe account
BankAccount account = new BankAccount();
account.Owner = "Alice";
account.Deposit(1000.00m);

// SAFE operations through methods
account.Deposit(500.00m);     // Works: adds $500
account.Withdraw(300.00m);    // Works: has enough money

// CAN'T do bad things anymore!
// account.balance = -5000.00m;      // ERROR: private!
// account.balance = 9999999.99m;    // ERROR: private!

Console.WriteLine("Final balance: $" + account.GetBalance());`,
            example3: `public class SocialMediaAccount
{
    // Public info (like profile)
    public string Username;
    public string DisplayName;
    public int PostCount;
    
    // Private info (like backend data)
    private string password;
    private string email;
    private DateTime dateCreated;
    private bool isVerified;
    
    // Protected info (for special features)
    protected int adminLevel;  // For moderator/child classes
    
    // Constructor
    public SocialMediaAccount(string user, string pass, string mail)
    {
        Username = user;
        password = pass;        // Private - set once
        email = mail;           // Private - hidden
        dateCreated = DateTime.Now;
        isVerified = false;
        PostCount = 0;
    }
    
    // Public methods for interaction
    public bool Login(string enteredPassword)
    {
        if (enteredPassword == password)
        {
            Console.WriteLine(Username + " logged in successfully.");
            return true;
        }
        else
        {
            Console.WriteLine("Login failed - wrong password.");
            return false;
        }
    }
    
    public void ChangePassword(string oldPass, string newPass)
    {
        if (oldPass == password && newPass.Length >= 8)
        {
            password = newPass;  // Can access private field
            Console.WriteLine("Password changed successfully.");
        }
        else
        {
            Console.WriteLine("Password change failed.");
        }
    }
    
    public void MakePost(string content)
    {
        PostCount++;            // Update public counter
        Console.WriteLine(Username + " posted: " + content);
        Console.WriteLine("Total posts: " + PostCount);
    }
    
    // Private helper method
    private void SendVerificationEmail()
    {
        Console.WriteLine("Verification email sent to " + email);
    }
    
    // Public method that uses private method
    public void RequestVerification()
    {
        if (!isVerified)
        {
            SendVerificationEmail();  // Can call private method
            Console.WriteLine("Verification requested.");
        }
    }
}

// Using the social media account
SocialMediaAccount myAccount = new SocialMediaAccount("alice123", "secret123", "alice@email.com");

// Public access works
myAccount.DisplayName = "Alice Wonderland";
myAccount.MakePost("Hello world!");
myAccount.Login("secret123");

// Private access fails
// myAccount.password = "hacked";      // ERROR: private!
// myAccount.email = "hacker@evil.com"; // ERROR: private!
// myAccount.SendVerificationEmail();  // ERROR: private!

// Using public methods that control private data
myAccount.ChangePassword("secret123", "newSecret456");
myAccount.RequestVerification();`
        },

        currentStep: 0,

        convertCode: function(id) {
            const toggle = document.getElementById(id + "Toggle");
            const isComplete = toggle ? toggle.checked : false;
            const codeBlock = document.getElementById(id + "Code");
            const resultBox = document.getElementById(id + "Result");

            if (codeBlock && toggle) {
                codeBlock.style.transition = 'opacity 0.3s ease';
                codeBlock.style.opacity = '0.5';
                setTimeout(() => {
                    codeBlock.textContent = isComplete ? this.completeExamples[id] : this.simpleExamples[id];
                    codeBlock.style.opacity = '1';

                    if (resultBox && id === 'example1') {
                        resultBox.innerHTML = isComplete ? 
                            '<strong>Output:</strong><br>Alice\'s balance: $1000<br>Alice\'s balance: $9999999.99<br><br><em>The Problem:</em> With <code>public Balance</code>, ANY code can set it to ANY value - negative, billion dollars, anything! This breaks the rules of how bank accounts should work. Real banks don\'t let you just change your balance number!' :
                            '<strong>Code Structure:</strong><br>Dangerous public BankAccount class.<br>Balance and Owner are public - anyone can modify them directly.<br>No protection against invalid values.<br><br><em>Toggle to see the full dangerous example!</em>';
                    } else if (resultBox && id === 'example2') {
                        resultBox.innerHTML = isComplete ?
                            '<strong>Output:</strong><br>Deposited: $1000<br>Deposited: $500<br>Withdrew: $300<br>Final balance: $1200<br><br><em>The Protection:</em> The <code>balance</code> field is <code>private</code>, so no outside code can touch it directly. All access goes through our controlled methods (<code>Deposit()</code>, <code>Withdraw()</code>, <code>GetBalance()</code>) that have validation rules. This is REAL encapsulation!' :
                            '<strong>Code Structure:</strong><br>Safe private BankAccount class.<br>balance and owner are private - hidden from outside.<br>Public methods provide controlled access with validation.<br><br><em>Toggle to see the full safe example!</em>';
                    } else if (resultBox && id === 'example3') {
                        resultBox.innerHTML = isComplete ?
                            '<strong>Output:</strong><br>Alice Wonderland posted: Hello world!<br>Total posts: 1<br>alice123 logged in successfully.<br>Password changed successfully.<br>Verification email sent to alice@email.com<br>Verification requested.<br><br><em>Perfect Encapsulation:</em> The user\'s password and email are <code>private</code> - completely hidden. Users can only change them through controlled methods (<code>ChangePassword()</code>, <code>Login()</code>) that have security checks. Private helper methods handle internal details safely.' :
                            '<strong>Code Structure:</strong><br>SocialMediaAccount with mixed access.<br>Public: Username, DisplayName, PostCount<br>Private: password, email (hidden)<br>Protected: adminLevel (for child classes)<br>Controlled public methods for interaction.<br><br><em>Toggle to see the complete social media example!</em>';
                    }
                }, 300);
            }
        },

        updateWalkthrough: function(step) {
            const walkthroughCodeBase = document.getElementById('walkthroughCodeBase');
            const walkthroughVariables = document.getElementById('walkthroughVariables');
            const walkthroughExplanation = document.getElementById('walkthroughExplanation');
            const nextStepBtn = document.getElementById('nextStepBtn');

            if (!walkthroughCodeBase || !walkthroughVariables || !walkthroughExplanation) return;

            const data = this.encapsulationSteps[step];
            
            walkthroughCodeBase.textContent = data.code;
            walkthroughVariables.textContent = data.vars;
            walkthroughExplanation.innerHTML = `<em>Step ${step + 1}:</em> ${data.exp}`;
            
            if (step === this.encapsulationSteps.length - 1 && nextStepBtn) {
                walkthroughExplanation.innerHTML += '<br><strong>Complete! Encapsulation protects private data from direct access.</strong>';
                nextStepBtn.disabled = true;
            }
        },

        nextStep: function() {
            if (this.currentStep < this.encapsulationSteps.length) {
                this.updateWalkthrough(this.currentStep);
                this.currentStep++;
            }
        },

        initWalkthrough: function() {
            const nextStepBtn = document.getElementById('nextStepBtn');
            if (nextStepBtn) {
                this.currentStep = 0;

                const newButton = nextStepBtn.cloneNode(true);
                nextStepBtn.parentNode.replaceChild(newButton, nextStepBtn);

                newButton.addEventListener('click', () => this.nextStep());
                newButton.disabled = false;
                
                this.updateWalkthrough(0);
                this.currentStep = 1;
            }
        },

        initCodeExamples: function() {
            const toggles = document.querySelectorAll('.form-check-input[type="checkbox"]');
            toggles.forEach(toggle => {
                const id = toggle.id.replace('Toggle', '');
                if (id && this.simpleExamples[id]) {
                    this.convertCode(id);
                    toggle.addEventListener('change', () => this.convertCode(id));
                }
            });
        },

        init: function() {
            console.log('Initializing OOP Encapsulation page');
            this.initCodeExamples();
            this.initWalkthrough();
            
            if (typeof hljs !== 'undefined') {
                hljs.highlightAll();
            }
        }
    };

    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => {
            window.oopEncapsulation.init();
        });
    } else {
        window.oopEncapsulation.init();
    }
</script>
</body>